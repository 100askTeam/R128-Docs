"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[1993],{6154:(n,e,i)=>{i.r(e),i.d(e,{assets:()=>l,contentTitle:()=>d,default:()=>u,frontMatter:()=>c,metadata:()=>t,toc:()=>_});var s=i(5893),r=i(1151);const c={},d="USB",t={id:"developer-guide/part2/chapter24",title:"USB",description:"USB \u9a71\u52a8\u4e3b\u8981\u5b9e\u73b0\u8bbe\u5907\u9a71\u52a8\u7684\u5e95\u5c42\u7ec6\u8282\uff0c\u5e76\u4e3a\u4e0a\u5c42\u63d0\u4f9b\u4e00\u5957\u6807\u51c6\u7684 API \u63a5\u53e3\u4ee5\u4f9b\u4f7f\u7528\u3002USB\u6a21\u5757\u4e3b\u8981\u7279\u6027\u5982\u4e0b\uff1a",source:"@site/docs/developer-guide/part2/chapter24.md",sourceDirName:"developer-guide/part2",slug:"/developer-guide/part2/chapter24",permalink:"/developer-guide/part2/chapter24",draft:!1,unlisted:!1,editUrl:"https://github.com/100askTeam/R128-Docs/tree/main/docs/developer-guide/part2/chapter24.md",tags:[],version:"current",frontMatter:{},sidebar:"classpartoneSidebar",previous:{title:"Smart Card",permalink:"/developer-guide/part2/chapter23"},next:{title:"SPI",permalink:"/developer-guide/part2/chapter25"}},l={},_=[{value:"\u6a21\u5757\u914d\u7f6e",id:"\u6a21\u5757\u914d\u7f6e",level:2},{value:"\u6e90\u7801\u7ed3\u6784",id:"\u6e90\u7801\u7ed3\u6784",level:2},{value:"\u6a21\u5757\u63a5\u53e3\u8bf4\u660e",id:"\u6a21\u5757\u63a5\u53e3\u8bf4\u660e",level:2},{value:"UDC \u56de\u8c03\u4e8b\u4ef6\u7ed3\u6784\u4f53",id:"udc-\u56de\u8c03\u4e8b\u4ef6\u7ed3\u6784\u4f53",level:3},{value:"USB \u9a71\u52a8\u521d\u59cb\u5316",id:"usb-\u9a71\u52a8\u521d\u59cb\u5316",level:3},{value:"USB HOST \u521d\u59cb\u5316",id:"usb-host-\u521d\u59cb\u5316",level:3},{value:"USB HOST \u53bb\u521d\u59cb\u5316",id:"usb-host-\u53bb\u521d\u59cb\u5316",level:3},{value:"USB HOST \u52a0\u8f7d\u6240\u6709\u4e3b\u673a\u9a71\u52a8\uff08\u9664\u4e860\uff09",id:"usb-host-\u52a0\u8f7d\u6240\u6709\u4e3b\u673a\u9a71\u52a8\u9664\u4e860",level:3},{value:"USB HOST \u53bb\u52a0\u8f7d\u6240\u6709\u4e3b\u673a\u9a71\u52a8\uff08\u9664\u4e860\uff09",id:"usb-host-\u53bb\u52a0\u8f7d\u6240\u6709\u4e3b\u673a\u9a71\u52a8\u9664\u4e860",level:3},{value:"USB HOST \u52a0\u8f7d\u6307\u5b9a\u4e3b\u673a\u9a71\u52a8",id:"usb-host-\u52a0\u8f7d\u6307\u5b9a\u4e3b\u673a\u9a71\u52a8",level:3},{value:"USB HOST \u53bb\u52a0\u8f7d\u6307\u5b9a\u4e3b\u673a\u9a71\u52a8",id:"usb-host-\u53bb\u52a0\u8f7d\u6307\u5b9a\u4e3b\u673a\u9a71\u52a8",level:3},{value:"USB HOST PHY \u533a\u57df\u663e\u793a",id:"usb-host-phy-\u533a\u57df\u663e\u793a",level:3},{value:"USB HOST PHY \u914d\u7f6e\u533a\u57df",id:"usb-host-phy-\u914d\u7f6e\u533a\u57df",level:3},{value:"USB HOST \u663e\u793a\u9a71\u52a8\u80fd\u529b",id:"usb-host-\u663e\u793a\u9a71\u52a8\u80fd\u529b",level:3},{value:"USB HOST \u914d\u7f6e\u9a71\u52a8\u80fd\u529b",id:"usb-host-\u914d\u7f6e\u9a71\u52a8\u80fd\u529b",level:3},{value:"USB HOST \u773c\u56fe\u6d4b\u8bd5",id:"usb-host-\u773c\u56fe\u6d4b\u8bd5",level:3},{value:"USB UDC \u521d\u59cb\u5316",id:"usb-udc-\u521d\u59cb\u5316",level:3},{value:"USB UDC \u53bb\u521d\u59cb\u5316",id:"usb-udc-\u53bb\u521d\u59cb\u5316",level:3},{value:"USB UDC EP \u8bfb\u64cd\u4f5c",id:"usb-udc-ep-\u8bfb\u64cd\u4f5c",level:3},{value:"USB UDC EP \u5199\u64cd\u4f5c",id:"usb-udc-ep-\u5199\u64cd\u4f5c",level:3},{value:"USB UDC \u521d\u59cb\u5316\u8bbe\u5907\u63cf\u8ff0\u7b26",id:"usb-udc-\u521d\u59cb\u5316\u8bbe\u5907\u63cf\u8ff0\u7b26",level:3},{value:"USB UDC \u914d\u7f6e\u63cf\u8ff0\u7b26\u521d\u59cb\u5316",id:"usb-udc-\u914d\u7f6e\u63cf\u8ff0\u7b26\u521d\u59cb\u5316",level:3},{value:"USB UDC \u5b57\u7b26\u4e32\u63cf\u8ff0\u7b26\u521d\u59cb\u5316",id:"usb-udc-\u5b57\u7b26\u4e32\u63cf\u8ff0\u7b26\u521d\u59cb\u5316",level:3},{value:"USB UDC \u6ce8\u518c\u56de\u8c03\u51fd\u6570",id:"usb-udc-\u6ce8\u518c\u56de\u8c03\u51fd\u6570",level:3},{value:"USB UDC \u7981\u7528 EP",id:"usb-udc-\u7981\u7528-ep",level:3},{value:"USB UDC \u542f\u7528 EP",id:"usb-udc-\u542f\u7528-ep",level:3},{value:"USB UDC \u8bbe\u7f6e EP \u53d1\u9001/\u63a5\u6536 buffer",id:"usb-udc-\u8bbe\u7f6e-ep-\u53d1\u9001\u63a5\u6536-buffer",level:3},{value:"USB UDC \u663e\u793a\u9a71\u52a8\u80fd\u529b",id:"usb-udc-\u663e\u793a\u9a71\u52a8\u80fd\u529b",level:3},{value:"USB UDC \u8c03\u6574\u9a71\u52a8\u80fd\u529b",id:"usb-udc-\u8c03\u6574\u9a71\u52a8\u80fd\u529b",level:3},{value:"USB UDC \u663e\u793a\u8303\u56f4",id:"usb-udc-\u663e\u793a\u8303\u56f4",level:3},{value:"USB UDC \u914d\u7f6e\u8303\u56f4",id:"usb-udc-\u914d\u7f6e\u8303\u56f4",level:3},{value:"USB UDC \u773c\u56fe\u6d4b\u8bd5",id:"usb-udc-\u773c\u56fe\u6d4b\u8bd5",level:3},{value:"USB Manager \u521d\u59cb\u5316",id:"usb-manager-\u521d\u59cb\u5316",level:3},{value:"USB Manager \u53bb\u521d\u59cb\u5316",id:"usb-manager-\u53bb\u521d\u59cb\u5316",level:3},{value:"USB Gadget \u521d\u59cb\u5316",id:"usb-gadget-\u521d\u59cb\u5316",level:3},{value:"USB Gadget \u53bb\u521d\u59cb\u5316",id:"usb-gadget-\u53bb\u521d\u59cb\u5316",level:3},{value:"USB Gadget \u542f\u7528\u529f\u80fd",id:"usb-gadget-\u542f\u7528\u529f\u80fd",level:3},{value:"USB Gadget \u7981\u7528\u529f\u80fd",id:"usb-gadget-\u7981\u7528\u529f\u80fd",level:3},{value:"USB Gadget \u8bfb\u53d6",id:"usb-gadget-\u8bfb\u53d6",level:3},{value:"USB Gadget \u9650\u65f6\u8bfb\u53d6",id:"usb-gadget-\u9650\u65f6\u8bfb\u53d6",level:3},{value:"USB Gadget \u5199\u6570\u636e",id:"usb-gadget-\u5199\u6570\u636e",level:3},{value:"USB Gadget \u5199\u5b57\u7b26\u4e32",id:"usb-gadget-\u5199\u5b57\u7b26\u4e32",level:3},{value:"\u6a21\u5757\u4f7f\u7528\u8303\u4f8b",id:"\u6a21\u5757\u4f7f\u7528\u8303\u4f8b",level:2},{value:"\u6d4b\u8bd5\u7528\u4f8b\u516c\u5171\u5934\u6587\u4ef6",id:"\u6d4b\u8bd5\u7528\u4f8b\u516c\u5171\u5934\u6587\u4ef6",level:3},{value:"HCI \u6d4b\u8bd5\u5b9e\u73b0\u5b9e\u73b0",id:"hci-\u6d4b\u8bd5\u5b9e\u73b0\u5b9e\u73b0",level:3},{value:"MSG \u6d4b\u8bd5\u7528\u4f8b\u5b9e\u73b0",id:"msg-\u6d4b\u8bd5\u7528\u4f8b\u5b9e\u73b0",level:3},{value:"PHY \u9a71\u52a8\u6d4b\u8bd5\u5b9e\u73b0",id:"phy-\u9a71\u52a8\u6d4b\u8bd5\u5b9e\u73b0",level:3},{value:"USB UDC \u6d4b\u8bd5\u7528\u4f8b\u5b9e\u73b0",id:"usb-udc-\u6d4b\u8bd5\u7528\u4f8b\u5b9e\u73b0",level:3},{value:"USB UVC \u6d4b\u8bd5\u7528\u4f8b\u5b9e\u73b0",id:"usb-uvc-\u6d4b\u8bd5\u7528\u4f8b\u5b9e\u73b0",level:3},{value:"USB \u6d4b\u8bd5\u7528\u4f8b",id:"usb-\u6d4b\u8bd5\u7528\u4f8b",level:3}];function a(n){const e={blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",ul:"ul",...(0,r.a)(),...n.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(e.h1,{id:"usb",children:"USB"}),"\n",(0,s.jsx)(e.p,{children:"USB \u9a71\u52a8\u4e3b\u8981\u5b9e\u73b0\u8bbe\u5907\u9a71\u52a8\u7684\u5e95\u5c42\u7ec6\u8282\uff0c\u5e76\u4e3a\u4e0a\u5c42\u63d0\u4f9b\u4e00\u5957\u6807\u51c6\u7684 API \u63a5\u53e3\u4ee5\u4f9b\u4f7f\u7528\u3002USB\u6a21\u5757\u4e3b\u8981\u7279\u6027\u5982\u4e0b\uff1a"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"Complies with USB 2.0 Specification"}),"\n",(0,s.jsx)(e.li,{children:"Supports High-Speed (HS, 480-Mbps), Full-Speed (FS, 12-Mbps), and Low-Speed (LS, 1.5-Mbps) in Host mode"}),"\n",(0,s.jsx)(e.li,{children:"Supports High-Speed (HS, 480 Mbps), Full-Speed (FS, 12 Mbps) in Device mode"}),"\n",(0,s.jsx)(e.li,{children:"Supports the UTMI+ Level 3 interface. The 8-bit bidirectional data buses are used"}),"\n",(0,s.jsx)(e.li,{children:"Supports bi-directional endpoint0 for Control transfer"}),"\n",(0,s.jsx)(e.li,{children:"Supports up to 8 User-Configurable Endpoints for Bulk, Isochronous and Interrupt bi-directional transfers (Endpoint1, Endpoint2, Endpoint3, Endpoint4)"}),"\n",(0,s.jsx)(e.li,{children:"Supports up to (4KB+64Bytes) FIFO for EPs (Including EP0)"}),"\n",(0,s.jsx)(e.li,{children:"Supports High-Bandwidth Isochronous & Interrupt transfers"}),"\n",(0,s.jsx)(e.li,{children:"Automated splitting/combining of packets for Bulk transfers"}),"\n",(0,s.jsx)(e.li,{children:"Supports point-to-point and point-to-multipoint transfer in both Host and Peripheral mode"}),"\n",(0,s.jsx)(e.li,{children:"Includes automatic ping capabilities"}),"\n",(0,s.jsx)(e.li,{children:"Soft connect/disconnect function"}),"\n",(0,s.jsx)(e.li,{children:"Performs all transaction scheduling in hardware"}),"\n",(0,s.jsx)(e.li,{children:"Power Optimization and Power Management capabilities"}),"\n",(0,s.jsx)(e.li,{children:"Includes interface to an external Normal DMA controller for every Eps"}),"\n"]}),"\n",(0,s.jsx)(e.h2,{id:"\u6a21\u5757\u914d\u7f6e",children:"\u6a21\u5757\u914d\u7f6e"}),"\n",(0,s.jsxs)(e.blockquote,{children:["\n",(0,s.jsx)(e.p,{children:"R128 \u4ec5\u6709\u4e00\u4e2a USB\uff0cHAL \u9a71\u52a8\u652f\u6301\u4e24\u4e2a\u53ca\u4ee5\u4e0a USB \u5916\u8bbe\uff0c\u6545\u90e8\u5206\u914d\u7f6e\u4e3a\u7a7a\u3002"}),"\n"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{children:"Kernel Setup ---\x3e\n    Drivers Setup ---\x3e\n        SoC HAL Drivers ---\x3e\n            USB devices ---\x3e\n                [*] enable USB driver\n                [*] USB HOST  ---\x3e\n                    [*]   Support usb host ehci0 # USB0 \u914d\u7f6e\n                    [*]   Support usb host ohci0\n                    [ ]   Support usb host ehci1 # USB1 \u914d\u7f6e\n                    [ ]   Support usb host ohci1 \n                    [*]     Mass Storage support\n                    [*]       USB CD support\n                    [ ]     Carplay host support\n                    [ ]     UVC support\n                    [ ]     HID support\n                [*] USB DEVICE  ---\x3e\n                    [ ]   enable dma for udc driver\n                    [*]   Support usb gadget driver\n                        usb gadget driver (adb gadget driver)  ---\x3e\n                            (X) adb gadget driver\n                            ( ) mtp gadget driver\n                            ( ) uac gadget driver\n                            ( ) ncm gadget driver\n                            ( ) msc gadget driver\n                [*] USB MANAGER\n"})}),"\n",(0,s.jsx)(e.h2,{id:"\u6e90\u7801\u7ed3\u6784",children:"\u6e90\u7801\u7ed3\u6784"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{children:".\n\u251c\u2500\u2500 Kconfig\n\u251c\u2500\u2500 Makefile\n\u251c\u2500\u2500 common               # \u516c\u5171\u64cd\u4f5c\n\u2502   \u251c\u2500\u2500 Makefile\n\u2502   \u251c\u2500\u2500 list_head_ext.c\n\u2502   \u251c\u2500\u2500 list_head_ext.h\n\u2502   \u251c\u2500\u2500 usb_init.c\n\u2502   \u251c\u2500\u2500 usb_init.h\n\u2502   \u251c\u2500\u2500 usb_phy.c\n\u2502   \u2514\u2500\u2500 usb_phy.h\n\u251c\u2500\u2500 core                 # USB \u6838\u5fc3\u9a71\u52a8\n\u2502   \u251c\u2500\u2500 Makefile\n\u2502   \u251c\u2500\u2500 urb.c\n\u2502   \u251c\u2500\u2500 urb.h\n\u2502   \u251c\u2500\u2500 usb_core_base.c\n\u2502   \u251c\u2500\u2500 usb_core_base.h\n\u2502   \u251c\u2500\u2500 usb_core_config.c\n\u2502   \u251c\u2500\u2500 usb_core_config.h\n\u2502   \u251c\u2500\u2500 usb_core_init.c\n\u2502   \u251c\u2500\u2500 usb_core_init.h\n\u2502   \u251c\u2500\u2500 usb_core_interface.c\n\u2502   \u251c\u2500\u2500 usb_core_interface.h\n\u2502   \u251c\u2500\u2500 usb_driver_init.c\n\u2502   \u251c\u2500\u2500 usb_driver_init.h\n\u2502   \u251c\u2500\u2500 usb_gen_hcd.c\n\u2502   \u251c\u2500\u2500 usb_gen_hcd.h\n\u2502   \u251c\u2500\u2500 usb_gen_hcd_rh.c\n\u2502   \u251c\u2500\u2500 usb_gen_hcd_rh.h\n\u2502   \u251c\u2500\u2500 usb_gen_hub.c\n\u2502   \u251c\u2500\u2500 usb_gen_hub.h\n\u2502   \u251c\u2500\u2500 usb_gen_hub_base.c\n\u2502   \u251c\u2500\u2500 usb_gen_hub_base.h\n\u2502   \u251c\u2500\u2500 usb_msg.c\n\u2502   \u251c\u2500\u2500 usb_msg.h\n\u2502   \u251c\u2500\u2500 usb_msg_base.c\n\u2502   \u251c\u2500\u2500 usb_msg_base.h\n\u2502   \u251c\u2500\u2500 usb_virt_bus.c\n\u2502   \u2514\u2500\u2500 usb_virt_bus.h\n\u251c\u2500\u2500 gadget             # gadget \u76f8\u5173\u5b9e\u73b0\n\u2502   \u251c\u2500\u2500 Makefile\n\u2502   \u251c\u2500\u2500 function\n\u2502   \u2502   \u251c\u2500\u2500 adb.c\n\u2502   \u2502   \u251c\u2500\u2500 msc\n\u2502   \u2502   \u2502   \u251c\u2500\u2500 msc.c\n\u2502   \u2502   \u2502   \u251c\u2500\u2500 scsi.c\n\u2502   \u2502   \u2502   \u251c\u2500\u2500 scsi.h\n\u2502   \u2502   \u2502   \u251c\u2500\u2500 usb_slave_msc.c\n\u2502   \u2502   \u2502   \u2514\u2500\u2500 usb_slave_msc.h\n\u2502   \u2502   \u251c\u2500\u2500 mtp.c\n\u2502   \u2502   \u2514\u2500\u2500 uac.c\n\u2502   \u251c\u2500\u2500 gadget.c\n\u2502   \u251c\u2500\u2500 gadget.h\n\u2502   \u2514\u2500\u2500 gadget_hal.c\n\u251c\u2500\u2500 hid                # hid \u76f8\u5173\u5b9e\u73b0\n\u2502   \u251c\u2500\u2500 Class   \n\u2502   \u2502   \u251c\u2500\u2500 Hid.c\n\u2502   \u2502   \u251c\u2500\u2500 HidProtocol.c\n\u2502   \u2502   \u251c\u2500\u2500 HidProtocol.h\n\u2502   \u2502   \u251c\u2500\u2500 HidTransport.c\n\u2502   \u2502   \u251c\u2500\u2500 HidTransport.h\n\u2502   \u2502   \u2514\u2500\u2500 Makefile\n\u2502   \u251c\u2500\u2500 Client        \n\u2502   \u2502   \u251c\u2500\u2500 KeyBoard\n\u2502   \u2502   \u2502   \u251c\u2500\u2500 KeyBoard.c\n\u2502   \u2502   \u2502   \u251c\u2500\u2500 KeyBoard.h\n\u2502   \u2502   \u2502   \u2514\u2500\u2500 Makefile\n\u2502   \u2502   \u251c\u2500\u2500 Makefile\n\u2502   \u2502   \u251c\u2500\u2500 Mouse\n\u2502   \u2502   \u2502   \u251c\u2500\u2500 Makefile\n\u2502   \u2502   \u2502   \u251c\u2500\u2500 UsbMouse.c\n\u2502   \u2502   \u2502   \u251c\u2500\u2500 UsbMouse.h\n\u2502   \u2502   \u2502   \u251c\u2500\u2500 UsbMouse_DriftControl.c\n\u2502   \u2502   \u2502   \u2514\u2500\u2500 UsbMouse_DriftControl.h\n\u2502   \u2502   \u2514\u2500\u2500 misc_lib.c\n\u2502   \u251c\u2500\u2500 Include\n\u2502   \u2502   \u251c\u2500\u2500 Hid.h\n\u2502   \u2502   \u251c\u2500\u2500 HidFunDrv.h\n\u2502   \u2502   \u251c\u2500\u2500 HidSpec.h\n\u2502   \u2502   \u251c\u2500\u2500 Hid_i.h\n\u2502   \u2502   \u2514\u2500\u2500 misc_lib.h\n\u2502   \u2514\u2500\u2500 Makefile\n\u251c\u2500\u2500 host               # Host \u9a71\u52a8\n\u2502   \u251c\u2500\u2500 Makefile\n\u2502   \u251c\u2500\u2500 ehci-hcd.c\n\u2502   \u251c\u2500\u2500 ehci-hub.c\n\u2502   \u251c\u2500\u2500 ehci-mem.c\n\u2502   \u251c\u2500\u2500 ehci-q.c\n\u2502   \u251c\u2500\u2500 ehci-sched.c\n\u2502   \u251c\u2500\u2500 ehci-sunxi.c\n\u2502   \u251c\u2500\u2500 ehci-timer.c\n\u2502   \u251c\u2500\u2500 ehci.h\n\u2502   \u251c\u2500\u2500 hci_hal.c\n\u2502   \u251c\u2500\u2500 ohci-hcd.c\n\u2502   \u251c\u2500\u2500 ohci-hub.c\n\u2502   \u251c\u2500\u2500 ohci-mem.c\n\u2502   \u251c\u2500\u2500 ohci-q.c\n\u2502   \u251c\u2500\u2500 ohci-sunxi.c\n\u2502   \u251c\u2500\u2500 ohci.h\n\u2502   \u251c\u2500\u2500 sunxi-hci.c\n\u2502   \u2514\u2500\u2500 sunxi-hci.h\n\u251c\u2500\u2500 include\n\u2502   \u251c\u2500\u2500 audio.h\n\u2502   \u251c\u2500\u2500 bitops.h\n\u2502   \u251c\u2500\u2500 ch11.h\n\u2502   \u251c\u2500\u2500 ch9.h\n\u2502   \u251c\u2500\u2500 ehci_def.h\n\u2502   \u251c\u2500\u2500 endian.h\n\u2502   \u251c\u2500\u2500 error.h\n\u2502   \u251c\u2500\u2500 hcd.h\n\u2502   \u251c\u2500\u2500 mod_devicetable.h\n\u2502   \u251c\u2500\u2500 mod_usbhost.h\n\u2502   \u251c\u2500\u2500 storage.h\n\u2502   \u251c\u2500\u2500 usb.h\n\u2502   \u251c\u2500\u2500 usb_list.h\n\u2502   \u251c\u2500\u2500 usb_melis.h\n\u2502   \u251c\u2500\u2500 usb_os_platform.h\n\u2502   \u2514\u2500\u2500 usb_rtos.h\n\u251c\u2500\u2500 manager           # usb \u7ba1\u7406\u7c7b\n\u2502   \u251c\u2500\u2500 Makefile\n\u2502   \u251c\u2500\u2500 sunxi_usb_board.h\n\u2502   \u251c\u2500\u2500 usb_hw_scan.c\n\u2502   \u251c\u2500\u2500 usb_hw_scan.h\n\u2502   \u251c\u2500\u2500 usb_manager.c\n\u2502   \u251c\u2500\u2500 usb_manager_common.h\n\u2502   \u251c\u2500\u2500 usb_msg_center.c\n\u2502   \u2514\u2500\u2500 usb_msg_center.h\n\u251c\u2500\u2500 platform          # \u82af\u7247\u5e73\u53f0\u5bc4\u5b58\u5668\u5b9a\u4e49\n\u2502   \u251c\u2500\u2500 sun20iw2\n\u2502   \u2502   \u251c\u2500\u2500 Makefile\n\u2502   \u2502   \u251c\u2500\u2500 usb_sun20iw2.c\n\u2502   \u2502   \u2514\u2500\u2500 usb_sun20iw2.h\n.   .   .\n.   .   .\n.   .   .\n\u251c\u2500\u2500 storage           # \u5b58\u50a8\u5668\u76f8\u5173\u5b9e\u73b0\n\u2502   \u251c\u2500\u2500 Class\n\u2502   \u2502   \u251c\u2500\u2500 Makefile\n\u2502   \u2502   \u251c\u2500\u2500 mscProtocol.c\n\u2502   \u2502   \u251c\u2500\u2500 mscProtocol.h\n\u2502   \u2502   \u251c\u2500\u2500 mscTransport.c\n\u2502   \u2502   \u251c\u2500\u2500 mscTransport.h\n\u2502   \u2502   \u251c\u2500\u2500 mscTransport_i.c\n\u2502   \u2502   \u251c\u2500\u2500 msc_common.h\n\u2502   \u2502   \u2514\u2500\u2500 usb_msc.c\n\u2502   \u251c\u2500\u2500 Disk\n\u2502   \u2502   \u251c\u2500\u2500 BlkDev.c\n\u2502   \u2502   \u251c\u2500\u2500 BlkDev.h\n\u2502   \u2502   \u251c\u2500\u2500 CD.c\n\u2502   \u2502   \u251c\u2500\u2500 CD.h\n\u2502   \u2502   \u251c\u2500\u2500 Disk.c\n\u2502   \u2502   \u251c\u2500\u2500 LunMgr.c\n\u2502   \u2502   \u251c\u2500\u2500 LunMgr_i.h\n\u2502   \u2502   \u251c\u2500\u2500 Makefile\n\u2502   \u2502   \u2514\u2500\u2500 Scsi2.c\n\u2502   \u251c\u2500\u2500 Kconfig\n\u2502   \u251c\u2500\u2500 Makefile\n\u2502   \u251c\u2500\u2500 Misc\n\u2502   \u2502   \u251c\u2500\u2500 Makefile\n\u2502   \u2502   \u251c\u2500\u2500 usbh_buff_manager.c\n\u2502   \u2502   \u251c\u2500\u2500 usbh_disk_info.c\n\u2502   \u2502   \u2514\u2500\u2500 usbh_disk_remove_time.c\n\u2502   \u2514\u2500\u2500 include\n\u2502       \u251c\u2500\u2500 LunMgr.h\n\u2502       \u251c\u2500\u2500 Scsi2.h\n\u2502       \u251c\u2500\u2500 usb_msc.h\n\u2502       \u251c\u2500\u2500 usb_msc_i.h\n\u2502       \u251c\u2500\u2500 usbh_buff_manager.h\n\u2502       \u251c\u2500\u2500 usbh_disk_info.h\n\u2502       \u2514\u2500\u2500 usbh_disk_remove_time.h\n\u251c\u2500\u2500 udc               # UDC \u5b9e\u73b0\n\u2502   \u251c\u2500\u2500 Makefile\n\u2502   \u251c\u2500\u2500 udc.c\n\u2502   \u251c\u2500\u2500 udc.h\n\u2502   \u251c\u2500\u2500 udc_hal.c\n\u2502   \u251c\u2500\u2500 udc_platform.h\n\u2502   \u251c\u2500\u2500 usb_dma.c\n\u2502   \u2514\u2500\u2500 usb_dma.h\n\u2514\u2500\u2500 uvc                # UVC \u5b9e\u73b0\n    \u251c\u2500\u2500 Class\n    \u2502   \u251c\u2500\u2500 Makefile\n    \u2502   \u251c\u2500\u2500 uvc.c\n    \u2502   \u251c\u2500\u2500 uvc_driver.c\n    \u2502   \u251c\u2500\u2500 uvc_driver.h\n    \u2502   \u251c\u2500\u2500 uvc_v4l2.c\n    \u2502   \u251c\u2500\u2500 uvc_video.c\n    \u2502   \u2514\u2500\u2500 uvc_video.h\n    \u251c\u2500\u2500 Include\n    \u2502   \u251c\u2500\u2500 UVC.h\n    \u2502   \u251c\u2500\u2500 assessibility.h\n    \u2502   \u251c\u2500\u2500 uvcvideo.h\n    \u2502   \u251c\u2500\u2500 video.h\n    \u2502   \u2514\u2500\u2500 videodev2.h\n    \u251c\u2500\u2500 Makefile\n    \u251c\u2500\u2500 Misc\n    \u2502   \u251c\u2500\u2500 Makefile\n    \u2502   \u2514\u2500\u2500 assessibility.c\n    \u251c\u2500\u2500 Webcam\n    \u2502   \u251c\u2500\u2500 Makefile\n    \u2502   \u251c\u2500\u2500 usbWebcam.c\n    \u2502   \u251c\u2500\u2500 usbWebcam.h\n    \u2502   \u251c\u2500\u2500 usbWebcam_proc.c\n    \u2502   \u2514\u2500\u2500 usbWebcam_proc.h\n    \u2514\u2500\u2500 drv_webcam\n        \u251c\u2500\u2500 Makefile\n        \u251c\u2500\u2500 dev_cfg\n        \u2502   \u251c\u2500\u2500 webcam_dev.c\n        \u2502   \u2514\u2500\u2500 webcam_dev_i.h\n        \u251c\u2500\u2500 drv_webcam.c\n        \u251c\u2500\u2500 drv_webcam.h\n        \u251c\u2500\u2500 drv_webcam_i.h\n        \u251c\u2500\u2500 fb.h\n        \u2514\u2500\u2500 webcam_core\n            \u251c\u2500\u2500 dev_webcam.c\n            \u251c\u2500\u2500 dev_webcam_i.h\n            \u251c\u2500\u2500 webcam_linklist_manager.c\n            \u2514\u2500\u2500 webcam_linklist_manager.h\n"})}),"\n",(0,s.jsx)(e.h2,{id:"\u6a21\u5757\u63a5\u53e3\u8bf4\u660e",children:"\u6a21\u5757\u63a5\u53e3\u8bf4\u660e"}),"\n",(0,s.jsx)(e.p,{children:"\u5934\u6587\u4ef6"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-c",children:"#include <sunxi_hal_usb.h>\n#include <usb_os_platform.h>\n"})}),"\n",(0,s.jsx)(e.h3,{id:"udc-\u56de\u8c03\u4e8b\u4ef6\u7ed3\u6784\u4f53",children:"UDC \u56de\u8c03\u4e8b\u4ef6\u7ed3\u6784\u4f53"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-c",children:"typedef enum {\n    UDC_EVENT_RX_STANDARD_REQUEST = 1,\n    UDC_EVENT_RX_CLASS_REQUEST = 2,\n    UDC_EVENT_RX_DATA = 3,\n    UDC_EVENT_TX_COMPLETE = 4,\n} udc_callback_event_t;\n"})}),"\n",(0,s.jsx)(e.p,{children:"### UDC \u9519\u8bef\u8fd4\u56de\u679a\u4e3e"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-c",children:"typedef enum {\n    UDC_ERRNO_SUCCESS = 0,\n    UDC_ERRNO_CMD_NOT_SUPPORTED = -1,\n    UDC_ERRNO_CMD_INVALID = -2,\n    UDC_ERRNO_BUF_NULL = -3,\n    UDC_ERRNO_BUF_FULL = -4,\n    UDC_ERRNO_EP_INVALID = -5,\n    UDC_ERRNO_RX_NOT_READY = -6,\n    UDC_ERRNO_TX_BUSY = -7,\n} udc_errno_t;\n"})}),"\n",(0,s.jsx)(e.h3,{id:"usb-\u9a71\u52a8\u521d\u59cb\u5316",children:"USB \u9a71\u52a8\u521d\u59cb\u5316"}),"\n",(0,s.jsx)(e.p,{children:"\u51fd\u6570\u539f\u578b"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-c",children:"void sunxi_usb_init(void);\n"})}),"\n",(0,s.jsx)(e.p,{children:"\u53c2\u6570\uff1a"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"\u65e0"}),"\n"]}),"\n",(0,s.jsx)(e.p,{children:"\u8fd4\u56de\u503c\uff1a"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"\u65e0"}),"\n"]}),"\n",(0,s.jsx)(e.h3,{id:"usb-host-\u521d\u59cb\u5316",children:"USB HOST \u521d\u59cb\u5316"}),"\n",(0,s.jsx)(e.p,{children:"\u51fd\u6570\u539f\u578b"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-c",children:"int hal_usb_core_init(void);\n"})}),"\n",(0,s.jsx)(e.p,{children:"\u53c2\u6570\uff1a"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"\u65e0"}),"\n"]}),"\n",(0,s.jsx)(e.p,{children:"\u8fd4\u56de\u503c\uff1a"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"0\uff1a\u6210\u529f"}),"\n",(0,s.jsx)(e.li,{children:"\u8d1f\u6570\uff1a\u5931\u8d25"}),"\n"]}),"\n",(0,s.jsx)(e.h3,{id:"usb-host-\u53bb\u521d\u59cb\u5316",children:"USB HOST \u53bb\u521d\u59cb\u5316"}),"\n",(0,s.jsx)(e.p,{children:"\u51fd\u6570\u539f\u578b"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-c",children:"int hal_usb_core_exit(void);\n"})}),"\n",(0,s.jsx)(e.p,{children:"\u53c2\u6570\uff1a"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"\u65e0"}),"\n"]}),"\n",(0,s.jsx)(e.p,{children:"\u8fd4\u56de\u503c\uff1a"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"0\uff1a\u6210\u529f"}),"\n",(0,s.jsx)(e.li,{children:"\u8d1f\u6570\uff1a\u5931\u8d25"}),"\n"]}),"\n",(0,s.jsx)(e.h3,{id:"usb-host-\u52a0\u8f7d\u6240\u6709\u4e3b\u673a\u9a71\u52a8\u9664\u4e860",children:"USB HOST \u52a0\u8f7d\u6240\u6709\u4e3b\u673a\u9a71\u52a8\uff08\u9664\u4e860\uff09"}),"\n",(0,s.jsx)(e.p,{children:"\u51fd\u6570\u539f\u578b"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-c",children:"int hal_usb_hci_init(void);\n"})}),"\n",(0,s.jsx)(e.p,{children:"\u53c2\u6570\uff1a"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"\u65e0"}),"\n"]}),"\n",(0,s.jsx)(e.p,{children:"\u8fd4\u56de\u503c\uff1a"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"0\uff1a\u6210\u529f"}),"\n",(0,s.jsx)(e.li,{children:"\u8d1f\u6570\uff1a\u5931\u8d25"}),"\n"]}),"\n",(0,s.jsx)(e.h3,{id:"usb-host-\u53bb\u52a0\u8f7d\u6240\u6709\u4e3b\u673a\u9a71\u52a8\u9664\u4e860",children:"USB HOST \u53bb\u52a0\u8f7d\u6240\u6709\u4e3b\u673a\u9a71\u52a8\uff08\u9664\u4e860\uff09"}),"\n",(0,s.jsx)(e.p,{children:"\u51fd\u6570\u539f\u578b"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-c",children:"int hal_usb_hci_deinit(void);\n"})}),"\n",(0,s.jsx)(e.p,{children:"\u53c2\u6570\uff1a"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"\u65e0"}),"\n"]}),"\n",(0,s.jsx)(e.p,{children:"\u8fd4\u56de\u503c\uff1a"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"0\uff1a\u6210\u529f"}),"\n",(0,s.jsx)(e.li,{children:"\u8d1f\u6570\uff1a\u5931\u8d25"}),"\n"]}),"\n",(0,s.jsx)(e.h3,{id:"usb-host-\u52a0\u8f7d\u6307\u5b9a\u4e3b\u673a\u9a71\u52a8",children:"USB HOST \u52a0\u8f7d\u6307\u5b9a\u4e3b\u673a\u9a71\u52a8"}),"\n",(0,s.jsx)(e.p,{children:"\u51fd\u6570\u539f\u578b"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-c",children:"int hal_usb_hcd_init(int hci_num);\n"})}),"\n",(0,s.jsx)(e.p,{children:"\u53c2\u6570\uff1a"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"hci_num\uff1a\u6307\u5b9a\u4e3b\u673a\u9a71\u52a8"}),"\n"]}),"\n",(0,s.jsx)(e.p,{children:"\u8fd4\u56de\u503c\uff1a"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"0\uff1a\u6210\u529f"}),"\n",(0,s.jsx)(e.li,{children:"\u8d1f\u6570\uff1a\u5931\u8d25"}),"\n"]}),"\n",(0,s.jsx)(e.h3,{id:"usb-host-\u53bb\u52a0\u8f7d\u6307\u5b9a\u4e3b\u673a\u9a71\u52a8",children:"USB HOST \u53bb\u52a0\u8f7d\u6307\u5b9a\u4e3b\u673a\u9a71\u52a8"}),"\n",(0,s.jsx)(e.p,{children:"\u51fd\u6570\u539f\u578b"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-c",children:"int hal_usb_hcd_deinit(int hci_num);\n"})}),"\n",(0,s.jsx)(e.p,{children:"\u53c2\u6570\uff1a"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"hci_num\uff1a\u6307\u5b9a\u4e3b\u673a\u9a71\u52a8"}),"\n"]}),"\n",(0,s.jsx)(e.p,{children:"\u8fd4\u56de\u503c\uff1a"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"0\uff1a\u6210\u529f"}),"\n",(0,s.jsx)(e.li,{children:"\u8d1f\u6570\uff1a\u5931\u8d25"}),"\n"]}),"\n",(0,s.jsx)(e.h3,{id:"usb-host-phy-\u533a\u57df\u663e\u793a",children:"USB HOST PHY \u533a\u57df\u663e\u793a"}),"\n",(0,s.jsx)(e.p,{children:"\u51fd\u6570\u539f\u578b"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-c",children:"void hal_hci_phy_range_show(int hci_num);\n"})}),"\n",(0,s.jsx)(e.p,{children:"\u53c2\u6570\uff1a"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"hci_num\uff1a\u6307\u5b9a\u4e3b\u673a\u9a71\u52a8"}),"\n"]}),"\n",(0,s.jsx)(e.p,{children:"\u8fd4\u56de\u503c\uff1a"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"\u65e0"}),"\n"]}),"\n",(0,s.jsx)(e.h3,{id:"usb-host-phy-\u914d\u7f6e\u533a\u57df",children:"USB HOST PHY \u914d\u7f6e\u533a\u57df"}),"\n",(0,s.jsx)(e.p,{children:"\u51fd\u6570\u539f\u578b"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-c",children:"void hal_hci_phy_range_set(int hci_num, int val);\n"})}),"\n",(0,s.jsx)(e.p,{children:"\u53c2\u6570\uff1a"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"hci_num\uff1a\u6307\u5b9a\u4e3b\u673a\u9a71\u52a8"}),"\n",(0,s.jsx)(e.li,{children:"val\uff1a\u914d\u7f6e\u7684\u503c"}),"\n"]}),"\n",(0,s.jsx)(e.p,{children:"\u8fd4\u56de\u503c\uff1a"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"\u65e0"}),"\n"]}),"\n",(0,s.jsx)(e.h3,{id:"usb-host-\u663e\u793a\u9a71\u52a8\u80fd\u529b",children:"USB HOST \u663e\u793a\u9a71\u52a8\u80fd\u529b"}),"\n",(0,s.jsx)(e.p,{children:"\u51fd\u6570\u539f\u578b"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-c",children:"void hal_hci_driverlevel_show(int hci_num);\n"})}),"\n",(0,s.jsx)(e.p,{children:"\u53c2\u6570\uff1a"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"hci_num\uff1a\u6307\u5b9a\u4e3b\u673a\u9a71\u52a8"}),"\n"]}),"\n",(0,s.jsx)(e.p,{children:"\u8fd4\u56de\u503c\uff1a"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"\u65e0"}),"\n"]}),"\n",(0,s.jsx)(e.h3,{id:"usb-host-\u914d\u7f6e\u9a71\u52a8\u80fd\u529b",children:"USB HOST \u914d\u7f6e\u9a71\u52a8\u80fd\u529b"}),"\n",(0,s.jsx)(e.p,{children:"\u51fd\u6570\u539f\u578b"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-c",children:"void hal_hci_driverlevel_adjust(int hci_num, int driverlevel);\n"})}),"\n",(0,s.jsx)(e.p,{children:"\u53c2\u6570\uff1a"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"hci_num\uff1a\u6307\u5b9a\u4e3b\u673a\u9a71\u52a8"}),"\n",(0,s.jsx)(e.li,{children:"driverlevel\uff1a\u914d\u7f6e\u7684\u9a71\u52a8\u80fd\u529b"}),"\n"]}),"\n",(0,s.jsx)(e.p,{children:"\u8fd4\u56de\u503c\uff1a"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"\u65e0"}),"\n"]}),"\n",(0,s.jsx)(e.h3,{id:"usb-host-\u773c\u56fe\u6d4b\u8bd5",children:"USB HOST \u773c\u56fe\u6d4b\u8bd5"}),"\n",(0,s.jsx)(e.p,{children:"\u51fd\u6570\u539f\u578b"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-c",children:"void hal_hci_ed_test(int hci_num, const char *buf, unsigned int count);\n"})}),"\n",(0,s.jsx)(e.p,{children:"\u53c2\u6570\uff1a"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"hci_num\uff1a\u6307\u5b9a\u4e3b\u673a\u9a71\u52a8"}),"\n",(0,s.jsx)(e.li,{children:"buf\uff1a\u4f20\u8f93\u7684\u6570\u636e"}),"\n",(0,s.jsx)(e.li,{children:"count\uff1a\u6570\u636e\u957f\u5ea6"}),"\n"]}),"\n",(0,s.jsx)(e.p,{children:"\u8fd4\u56de\u503c\uff1a"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"\u65e0"}),"\n"]}),"\n",(0,s.jsx)(e.h3,{id:"usb-udc-\u521d\u59cb\u5316",children:"USB UDC \u521d\u59cb\u5316"}),"\n",(0,s.jsx)(e.p,{children:"\u51fd\u6570\u539f\u578b"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-c",children:"int32_t hal_udc_init(void);\n"})}),"\n",(0,s.jsx)(e.p,{children:"\u53c2\u6570\uff1a"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"\u65e0"}),"\n"]}),"\n",(0,s.jsx)(e.p,{children:"\u8fd4\u56de\u503c\uff1a"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"0\uff1a\u6210\u529f"}),"\n",(0,s.jsx)(e.li,{children:"\u8d1f\u6570\uff1a\u5931\u8d25"}),"\n"]}),"\n",(0,s.jsx)(e.h3,{id:"usb-udc-\u53bb\u521d\u59cb\u5316",children:"USB UDC \u53bb\u521d\u59cb\u5316"}),"\n",(0,s.jsx)(e.p,{children:"\u51fd\u6570\u539f\u578b"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-c",children:"int32_t hal_udc_deinit(void);\n"})}),"\n",(0,s.jsx)(e.p,{children:"\u53c2\u6570\uff1a"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"\u65e0"}),"\n"]}),"\n",(0,s.jsx)(e.p,{children:"\u8fd4\u56de\u503c\uff1a"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"0\uff1a\u6210\u529f"}),"\n",(0,s.jsx)(e.li,{children:"\u8d1f\u6570\uff1a\u5931\u8d25"}),"\n"]}),"\n",(0,s.jsx)(e.h3,{id:"usb-udc-ep-\u8bfb\u64cd\u4f5c",children:"USB UDC EP \u8bfb\u64cd\u4f5c"}),"\n",(0,s.jsx)(e.p,{children:"\u51fd\u6570\u539f\u578b"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-c",children:"int32_t hal_udc_ep_read(uint8_t ep_addr, void *buf, uint32_t len);\n"})}),"\n",(0,s.jsx)(e.p,{children:"\u53c2\u6570\uff1a"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"ep_addr\uff1aep\u5730\u5740"}),"\n",(0,s.jsx)(e.li,{children:"buf\uff1a\u8bfb\u53d6\u7684\u6570\u636e\u6307\u9488"}),"\n",(0,s.jsx)(e.li,{children:"len\uff1a\u8bfb\u53d6\u957f\u5ea6"}),"\n"]}),"\n",(0,s.jsx)(e.p,{children:"\u8fd4\u56de\u503c\uff1a"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"0\uff1a\u6210\u529f"}),"\n",(0,s.jsx)(e.li,{children:"\u8d1f\u6570\uff1a\u5931\u8d25"}),"\n"]}),"\n",(0,s.jsx)(e.h3,{id:"usb-udc-ep-\u5199\u64cd\u4f5c",children:"USB UDC EP \u5199\u64cd\u4f5c"}),"\n",(0,s.jsx)(e.p,{children:"\u51fd\u6570\u539f\u578b"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-c",children:"int32_t hal_udc_ep_write(uint8_t ep_addr, void *buf , uint32_t len);\n"})}),"\n",(0,s.jsx)(e.p,{children:"\u53c2\u6570\uff1a"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"ep_addr\uff1aep\u5730\u5740"}),"\n",(0,s.jsx)(e.li,{children:"buf\uff1a\u8bfb\u53d6\u7684\u6570\u636e\u6307\u9488"}),"\n",(0,s.jsx)(e.li,{children:"len\uff1a\u8bfb\u53d6\u957f\u5ea6"}),"\n"]}),"\n",(0,s.jsx)(e.p,{children:"\u8fd4\u56de\u503c\uff1a"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"0\uff1a\u6210\u529f"}),"\n",(0,s.jsx)(e.li,{children:"\u8d1f\u6570\uff1a\u5931\u8d25"}),"\n"]}),"\n",(0,s.jsx)(e.h3,{id:"usb-udc-\u521d\u59cb\u5316\u8bbe\u5907\u63cf\u8ff0\u7b26",children:"USB UDC \u521d\u59cb\u5316\u8bbe\u5907\u63cf\u8ff0\u7b26"}),"\n",(0,s.jsx)(e.p,{children:"\u51fd\u6570\u539f\u578b"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-c",children:"void hal_udc_device_desc_init(void *device_desc);\n"})}),"\n",(0,s.jsx)(e.p,{children:"\u53c2\u6570\uff1a"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"device_desc\uff1a\u8bbe\u5907\u63cf\u8ff0\u7b26\u6570\u636e"}),"\n"]}),"\n",(0,s.jsx)(e.p,{children:"\u8fd4\u56de\u503c\uff1a"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"\u65e0"}),"\n"]}),"\n",(0,s.jsx)(e.h3,{id:"usb-udc-\u914d\u7f6e\u63cf\u8ff0\u7b26\u521d\u59cb\u5316",children:"USB UDC \u914d\u7f6e\u63cf\u8ff0\u7b26\u521d\u59cb\u5316"}),"\n",(0,s.jsx)(e.p,{children:"\u51fd\u6570\u539f\u578b"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-c",children:"void hal_udc_config_desc_init(void *config_desc, uint32_t len);\n"})}),"\n",(0,s.jsx)(e.p,{children:"\u53c2\u6570\uff1a"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"config_desc\uff1a\u914d\u7f6e\u63cf\u8ff0\u7b26\u6307\u9488"}),"\n",(0,s.jsx)(e.li,{children:"len\uff1a\u957f\u5ea6"}),"\n"]}),"\n",(0,s.jsx)(e.p,{children:"\u8fd4\u56de\u503c\uff1a"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"\u65e0"}),"\n"]}),"\n",(0,s.jsx)(e.h3,{id:"usb-udc-\u5b57\u7b26\u4e32\u63cf\u8ff0\u7b26\u521d\u59cb\u5316",children:"USB UDC \u5b57\u7b26\u4e32\u63cf\u8ff0\u7b26\u521d\u59cb\u5316"}),"\n",(0,s.jsx)(e.p,{children:"\u51fd\u6570\u539f\u578b"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-c",children:"void hal_udc_string_desc_init(const void *string_desc);\n"})}),"\n",(0,s.jsx)(e.p,{children:"\u53c2\u6570\uff1a"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"string_desc\uff1a\u914d\u7f6e\u5b57\u7b26\u4e32\u63cf\u8ff0\u7b26\u7684\u6307\u9488"}),"\n"]}),"\n",(0,s.jsx)(e.p,{children:"\u8fd4\u56de\u503c\uff1a"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"\u65e0"}),"\n"]}),"\n",(0,s.jsx)(e.h3,{id:"usb-udc-\u6ce8\u518c\u56de\u8c03\u51fd\u6570",children:"USB UDC \u6ce8\u518c\u56de\u8c03\u51fd\u6570"}),"\n",(0,s.jsx)(e.p,{children:"\u51fd\u6570\u539f\u578b"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-c",children:"void hal_udc_register_callback(udc_callback_t user_callback);\n"})}),"\n",(0,s.jsx)(e.p,{children:"\u53c2\u6570\uff1a"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"user_callback\uff1a\u56de\u8c03\u51fd\u6570"}),"\n"]}),"\n",(0,s.jsx)(e.p,{children:"\u8fd4\u56de\u503c\uff1a"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"\u65e0"}),"\n"]}),"\n",(0,s.jsx)(e.h3,{id:"usb-udc-\u7981\u7528-ep",children:"USB UDC \u7981\u7528 EP"}),"\n",(0,s.jsx)(e.p,{children:"\u51fd\u6570\u539f\u578b"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-c",children:"void hal_udc_ep_disable(uint8_t ep_addr);\n"})}),"\n",(0,s.jsx)(e.p,{children:"\u53c2\u6570\uff1a"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"ep_addr\uff1a\u5730\u5740"}),"\n"]}),"\n",(0,s.jsx)(e.p,{children:"\u8fd4\u56de\u503c\uff1a"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"\u65e0"}),"\n"]}),"\n",(0,s.jsx)(e.h3,{id:"usb-udc-\u542f\u7528-ep",children:"USB UDC \u542f\u7528 EP"}),"\n",(0,s.jsx)(e.p,{children:"\u51fd\u6570\u539f\u578b"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-c",children:"void hal_udc_ep_enable(uint8_t ep_addr, uint16_t maxpacket, uint32_t ts_type);\n"})}),"\n",(0,s.jsx)(e.p,{children:"\u53c2\u6570\uff1a"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"ep_addr\uff1a\u5730\u5740"}),"\n",(0,s.jsx)(e.li,{children:"maxpacket\uff1a\u6700\u5927\u5305\u5927\u5c0f"}),"\n",(0,s.jsx)(e.li,{children:"ts_type\uff1a\u6a21\u5f0f"}),"\n"]}),"\n",(0,s.jsx)(e.p,{children:"\u8fd4\u56de\u503c\uff1a"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"\u65e0"}),"\n"]}),"\n",(0,s.jsx)(e.h3,{id:"usb-udc-\u8bbe\u7f6e-ep-\u53d1\u9001\u63a5\u6536-buffer",children:"USB UDC \u8bbe\u7f6e EP \u53d1\u9001/\u63a5\u6536 buffer"}),"\n",(0,s.jsx)(e.p,{children:"\u51fd\u6570\u539f\u578b"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-c",children:"void hal_udc_ep_set_buf(uint8_t ep_addr, void *buf, uint32_t len);\n"})}),"\n",(0,s.jsx)(e.p,{children:"\u53c2\u6570\uff1a"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"ep_addr\uff1a\u5730\u5740"}),"\n",(0,s.jsx)(e.li,{children:"buf\uff1abuf\u7684\u6307\u9488"}),"\n",(0,s.jsx)(e.li,{children:"len\uff1abuf\u7684\u957f\u5ea6"}),"\n"]}),"\n",(0,s.jsx)(e.p,{children:"\u8fd4\u56de\u503c\uff1a"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"\u65e0"}),"\n"]}),"\n",(0,s.jsx)(e.h3,{id:"usb-udc-\u663e\u793a\u9a71\u52a8\u80fd\u529b",children:"USB UDC \u663e\u793a\u9a71\u52a8\u80fd\u529b"}),"\n",(0,s.jsx)(e.p,{children:"\u51fd\u6570\u539f\u578b"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-c",children:"void hal_udc_driverlevel_show(void);\n"})}),"\n",(0,s.jsx)(e.p,{children:"\u53c2\u6570\uff1a"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"\u65e0"}),"\n"]}),"\n",(0,s.jsx)(e.p,{children:"\u8fd4\u56de\u503c\uff1a"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"\u65e0"}),"\n"]}),"\n",(0,s.jsx)(e.h3,{id:"usb-udc-\u8c03\u6574\u9a71\u52a8\u80fd\u529b",children:"USB UDC \u8c03\u6574\u9a71\u52a8\u80fd\u529b"}),"\n",(0,s.jsx)(e.p,{children:"\u51fd\u6570\u539f\u578b"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-c",children:"void hal_udc_driverlevel_adjust(int driverlevel);\n"})}),"\n",(0,s.jsx)(e.p,{children:"\u53c2\u6570\uff1a"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"driverlevel\uff1a\u9a71\u52a8\u80fd\u529b"}),"\n"]}),"\n",(0,s.jsx)(e.p,{children:"\u8fd4\u56de\u503c\uff1a"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"\u65e0"}),"\n"]}),"\n",(0,s.jsx)(e.h3,{id:"usb-udc-\u663e\u793a\u8303\u56f4",children:"USB UDC \u663e\u793a\u8303\u56f4"}),"\n",(0,s.jsx)(e.p,{children:"\u51fd\u6570\u539f\u578b"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-c",children:"void hal_udc_phy_range_show(int usbc_num);\n"})}),"\n",(0,s.jsx)(e.p,{children:"\u53c2\u6570\uff1a"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"usbc_num\uff1ausb\u63a7\u5236\u5668\u53f7"}),"\n"]}),"\n",(0,s.jsx)(e.p,{children:"\u8fd4\u56de\u503c\uff1a"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"\u65e0"}),"\n"]}),"\n",(0,s.jsx)(e.h3,{id:"usb-udc-\u914d\u7f6e\u8303\u56f4",children:"USB UDC \u914d\u7f6e\u8303\u56f4"}),"\n",(0,s.jsx)(e.p,{children:"\u51fd\u6570\u539f\u578b"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-c",children:"void hal_udc_phy_range_set(int usbc_num, int val);\n"})}),"\n",(0,s.jsx)(e.p,{children:"\u53c2\u6570\uff1a"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"usbc_num\uff1ausb\u63a7\u5236\u5668\u53f7"}),"\n",(0,s.jsx)(e.li,{children:"val\uff1a\u503c"}),"\n"]}),"\n",(0,s.jsx)(e.p,{children:"\u8fd4\u56de\u503c\uff1a"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"\u65e0"}),"\n"]}),"\n",(0,s.jsx)(e.h3,{id:"usb-udc-\u773c\u56fe\u6d4b\u8bd5",children:"USB UDC \u773c\u56fe\u6d4b\u8bd5"}),"\n",(0,s.jsx)(e.p,{children:"\u51fd\u6570\u539f\u578b"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-c",children:"void hal_udc_ed_test(const char *buf, size_t count);\n"})}),"\n",(0,s.jsx)(e.p,{children:"\u53c2\u6570\uff1a"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"buf\uff1a\u6d4b\u8bd5\u4f7f\u7528\u7684buf"}),"\n",(0,s.jsx)(e.li,{children:"count\uff1a\u6570\u91cf"}),"\n"]}),"\n",(0,s.jsx)(e.p,{children:"\u8fd4\u56de\u503c\uff1a"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"\u65e0"}),"\n"]}),"\n",(0,s.jsx)(e.h3,{id:"usb-manager-\u521d\u59cb\u5316",children:"USB Manager \u521d\u59cb\u5316"}),"\n",(0,s.jsx)(e.p,{children:"\u51fd\u6570\u539f\u578b"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-c",children:"int hal_usb_manager_init(void);\n"})}),"\n",(0,s.jsx)(e.p,{children:"\u53c2\u6570\uff1a"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"\u65e0"}),"\n"]}),"\n",(0,s.jsx)(e.p,{children:"\u8fd4\u56de\u503c\uff1a"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"0\uff1a\u6210\u529f"}),"\n",(0,s.jsx)(e.li,{children:"\u8d1f\u6570\uff1a\u5931\u8d25"}),"\n"]}),"\n",(0,s.jsx)(e.h3,{id:"usb-manager-\u53bb\u521d\u59cb\u5316",children:"USB Manager \u53bb\u521d\u59cb\u5316"}),"\n",(0,s.jsx)(e.p,{children:"\u51fd\u6570\u539f\u578b"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-c",children:"int hal_usb_manager_deinit(void);\n"})}),"\n",(0,s.jsx)(e.p,{children:"\u53c2\u6570\uff1a"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"\u65e0"}),"\n"]}),"\n",(0,s.jsx)(e.p,{children:"\u8fd4\u56de\u503c\uff1a"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"0\uff1a\u6210\u529f"}),"\n",(0,s.jsx)(e.li,{children:"\u8d1f\u6570\uff1a\u5931\u8d25"}),"\n"]}),"\n",(0,s.jsx)(e.h3,{id:"usb-gadget-\u521d\u59cb\u5316",children:"USB Gadget \u521d\u59cb\u5316"}),"\n",(0,s.jsx)(e.p,{children:"\u51fd\u6570\u539f\u578b"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-c",children:"int hal_gadget_init(void);\n"})}),"\n",(0,s.jsx)(e.p,{children:"\u53c2\u6570\uff1a"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"\u65e0"}),"\n"]}),"\n",(0,s.jsx)(e.p,{children:"\u8fd4\u56de\u503c\uff1a"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"0\uff1a\u6210\u529f"}),"\n",(0,s.jsx)(e.li,{children:"\u8d1f\u6570\uff1a\u5931\u8d25"}),"\n"]}),"\n",(0,s.jsx)(e.h3,{id:"usb-gadget-\u53bb\u521d\u59cb\u5316",children:"USB Gadget \u53bb\u521d\u59cb\u5316"}),"\n",(0,s.jsx)(e.p,{children:"\u51fd\u6570\u539f\u578b"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-c",children:"void hal_gadget_exit(void);\n"})}),"\n",(0,s.jsx)(e.p,{children:"\u53c2\u6570\uff1a"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"\u65e0"}),"\n"]}),"\n",(0,s.jsx)(e.p,{children:"\u8fd4\u56de\u503c\uff1a"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"\u65e0"}),"\n"]}),"\n",(0,s.jsx)(e.h3,{id:"usb-gadget-\u542f\u7528\u529f\u80fd",children:"USB Gadget \u542f\u7528\u529f\u80fd"}),"\n",(0,s.jsx)(e.p,{children:"\u51fd\u6570\u539f\u578b"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-c",children:"int usb_gadget_function_enable(const char *name);\n"})}),"\n",(0,s.jsx)(e.p,{children:"\u53c2\u6570\uff1a"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"name\uff1a\u529f\u80fd\u540d"}),"\n"]}),"\n",(0,s.jsx)(e.p,{children:"\u8fd4\u56de\u503c\uff1a"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"0\uff1a\u6210\u529f"}),"\n",(0,s.jsx)(e.li,{children:"\u8d1f\u6570\uff1a\u5931\u8d25"}),"\n"]}),"\n",(0,s.jsx)(e.h3,{id:"usb-gadget-\u7981\u7528\u529f\u80fd",children:"USB Gadget \u7981\u7528\u529f\u80fd"}),"\n",(0,s.jsx)(e.p,{children:"\u51fd\u6570\u539f\u578b"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-c",children:"int usb_gadget_function_disable(const char *name);\n"})}),"\n",(0,s.jsx)(e.p,{children:"\u53c2\u6570\uff1a"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"name\uff1a\u529f\u80fd\u540d"}),"\n"]}),"\n",(0,s.jsx)(e.p,{children:"\u8fd4\u56de\u503c\uff1a"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"0\uff1a\u6210\u529f"}),"\n",(0,s.jsx)(e.li,{children:"\u8d1f\u6570\uff1a\u5931\u8d25"}),"\n"]}),"\n",(0,s.jsx)(e.h3,{id:"usb-gadget-\u8bfb\u53d6",children:"USB Gadget \u8bfb\u53d6"}),"\n",(0,s.jsx)(e.p,{children:"\u51fd\u6570\u539f\u578b"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-c",children:"int usb_gadget_function_read(int ep_idx, char *buf, int size);\n"})}),"\n",(0,s.jsx)(e.p,{children:"\u53c2\u6570\uff1a"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"ep_idx\uff1a\u7aef\u70b9\u53f7"}),"\n",(0,s.jsx)(e.li,{children:"buf\uff1abuf\u6307\u9488"}),"\n",(0,s.jsx)(e.li,{children:"size\uff1abuf\u7684\u5927\u5c0f"}),"\n"]}),"\n",(0,s.jsx)(e.p,{children:"\u8fd4\u56de\u503c\uff1a"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"0\uff1a\u6210\u529f"}),"\n",(0,s.jsx)(e.li,{children:"\u8d1f\u6570\uff1a\u5931\u8d25"}),"\n"]}),"\n",(0,s.jsx)(e.h3,{id:"usb-gadget-\u9650\u65f6\u8bfb\u53d6",children:"USB Gadget \u9650\u65f6\u8bfb\u53d6"}),"\n",(0,s.jsx)(e.p,{children:"\u51fd\u6570\u539f\u578b"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-c",children:"int usb_gadget_function_read_timeout(int ep_idx, char *buf, int size, int ms);\n"})}),"\n",(0,s.jsx)(e.p,{children:"\u53c2\u6570\uff1a"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"ep_idx\uff1a\u7aef\u70b9\u53f7"}),"\n",(0,s.jsx)(e.li,{children:"buf\uff1abuf\u6307\u9488"}),"\n",(0,s.jsx)(e.li,{children:"size\uff1abuf\u7684\u5927\u5c0f"}),"\n",(0,s.jsx)(e.li,{children:"ms\uff1a\u8d85\u65f6\u65f6\u95f4"}),"\n"]}),"\n",(0,s.jsx)(e.p,{children:"\u8fd4\u56de\u503c\uff1a"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"0\uff1a\u6210\u529f"}),"\n",(0,s.jsx)(e.li,{children:"\u8d1f\u6570\uff1a\u5931\u8d25"}),"\n"]}),"\n",(0,s.jsx)(e.h3,{id:"usb-gadget-\u5199\u6570\u636e",children:"USB Gadget \u5199\u6570\u636e"}),"\n",(0,s.jsx)(e.p,{children:"\u51fd\u6570\u539f\u578b"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-c",children:"int usb_gadget_function_write(int ep_idx, char *buf, int size);\n"})}),"\n",(0,s.jsx)(e.p,{children:"\u53c2\u6570\uff1a"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"ep_idx\uff1a\u7aef\u70b9\u53f7"}),"\n",(0,s.jsx)(e.li,{children:"buf\uff1abuf\u6307\u9488"}),"\n",(0,s.jsx)(e.li,{children:"size\uff1abuf\u7684\u5927\u5c0f"}),"\n"]}),"\n",(0,s.jsx)(e.p,{children:"\u8fd4\u56de\u503c\uff1a"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"0\uff1a\u6210\u529f"}),"\n",(0,s.jsx)(e.li,{children:"\u8d1f\u6570\uff1a\u5931\u8d25"}),"\n"]}),"\n",(0,s.jsx)(e.h3,{id:"usb-gadget-\u5199\u5b57\u7b26\u4e32",children:"USB Gadget \u5199\u5b57\u7b26\u4e32"}),"\n",(0,s.jsx)(e.p,{children:"\u51fd\u6570\u539f\u578b"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-c",children:"int usb_gadget_function_string_set(char *name, char *str, unsigned int idx);\n"})}),"\n",(0,s.jsx)(e.p,{children:"\u53c2\u6570\uff1a"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"name\uff1a\u540d\u79f0"}),"\n",(0,s.jsx)(e.li,{children:"str\uff1a\u5b57\u7b26\u4e32\u6307\u9488"}),"\n",(0,s.jsx)(e.li,{children:"idx\uff1a\u7aef\u70b9\u53f7"}),"\n"]}),"\n",(0,s.jsx)(e.p,{children:"\u8fd4\u56de\u503c\uff1a"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"0\uff1a\u6210\u529f"}),"\n",(0,s.jsx)(e.li,{children:"\u8d1f\u6570\uff1a\u5931\u8d25"}),"\n"]}),"\n",(0,s.jsx)(e.h2,{id:"\u6a21\u5757\u4f7f\u7528\u8303\u4f8b",children:"\u6a21\u5757\u4f7f\u7528\u8303\u4f8b"}),"\n",(0,s.jsx)(e.h3,{id:"\u6d4b\u8bd5\u7528\u4f8b\u516c\u5171\u5934\u6587\u4ef6",children:"\u6d4b\u8bd5\u7528\u4f8b\u516c\u5171\u5934\u6587\u4ef6"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{children:'usb_test.h\n#ifndef USB_TEST_H\n#define USB_TEST_H\n\n#include <sunxi_hal_usb.h>\n#include <usb_os_platform.h>\n\n#ifdef __cplusplus\nextern "C" {\n#endif\n\nint usb_test_cmd_hci(int argc, const char **argv);\nint usb_test_cmd_udc(int argc, const char **argv);\nint usb_test_cmd_phy_range(int argc, const char **argv);\nint usb_test_cmd_ed_test(int argc, const char **argv);\nint usb_test_cmd_debug(int argc, const char **argv);\nint usb_test_cmd_uvc(int argc, const char **argv);\n\n\nint usb_test_is_otg(int port);\nint usb_test_get_port(const char *buf, int *port);\nvoid usb_test_show_help(void);\n\nunsigned char usb_core_is_enabled(void);\nunsigned char sunxi_ehci_status_get(void);\n\n#ifdef __cplusplus\n}\n#endif\n\n#endif // USB_TEST_H\n'})}),"\n",(0,s.jsx)(e.h3,{id:"hci-\u6d4b\u8bd5\u5b9e\u73b0\u5b9e\u73b0",children:"HCI \u6d4b\u8bd5\u5b9e\u73b0\u5b9e\u73b0"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-c",children:'#include "usb_test.h"\n\nint usb_test_cmd_hci(int argc, const char **argv)\n{\n    int c;\n    int hci_num = 0;\n    unsigned int port = 0;\n\n    if (argc == 4) {\n        // insmod/rmmod indicate host driver\n        if (usb_test_get_port(argv[3], &port))\n            return 0;\n    } else if (argc == 3) {\n        // insmod/rmmod all host driver\n        port = 0xffff;\n    } else\n        return -1;\n\n    while ((c = getopt(argc, (char *const *)argv, "ir")) != -1) {\n        switch (c) {\n        case \'i\':\n#ifdef CONFIG_HAL_TEST_UDC\n            /*otg mode rmmod device driver before insmod hci*/\n            if (usb_test_is_otg(port)) {\n                printf("[usb0] rmmod device driver!\\n");\n                hal_gadget_exit();\n            }\n#endif\n            if (!usb_core_is_enabled())\n                hal_usb_core_init();\n\n            if (port == 0xffff)\n                for (hci_num = 0; hci_num < USB_MAX_CONTROLLER_COUNT; hci_num++)\n                    hal_usb_hcd_init(hci_num);\n            else\n                hal_usb_hcd_init(port);\n            break;\n        case \'r\':\n            if (port == 0xffff)\n                for (hci_num = 0; hci_num < USB_MAX_CONTROLLER_COUNT; hci_num++)\n                    hal_usb_hcd_deinit(hci_num);\n            else\n                hal_usb_hcd_deinit(port);\n\n            if (usb_core_is_enabled() && !sunxi_ehci_status_get())\n                hal_usb_core_exit();\n            break;\n        default:\n            printf("ERR: insmod/rmmod error!\\n");\n            usb_test_show_help();\n            break;\n        }\n    }\n\n    return 0;\n}\n\nint usb_test_cmd_debug(int argc, const char **argv)\n{\n    int enable = 0;\n\n    if (argc != 3)\n        return -1;\n\n    enable = atoi(argv[2]);\n    if (enable == 1 || enable == 0) {\n        hal_usb_hcd_debug_set(enable);\n        printf("USB debug %s!\\n", hal_usb_hcd_debug_get() ? "open" : "close");\n        return 0;\n    }\n\n    return -1;\n}\n'})}),"\n",(0,s.jsx)(e.h3,{id:"msg-\u6d4b\u8bd5\u7528\u4f8b\u5b9e\u73b0",children:"MSG \u6d4b\u8bd5\u7528\u4f8b\u5b9e\u73b0"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-c",children:"#include <inttypes.h>\n\n#include \"usb.h\"\n#include \"ch9.h\"\n#include \"storage.h\"\n#include \"usb_os_platform.h\"\n\n\nstruct usb_msg_dev {\n    uint8_t max_lun;\n    uint8_t cbw[32];\n};\n\nstatic struct usb_device_descriptor demo_device_desc = {\n    .bLength = USB_DT_DEVICE_SIZE,\n    .bDescriptorType = USB_DT_DEVICE,\n    .bcdUSB = 0x0200,\n    .bDeviceClass = 0,\n    .bDeviceSubClass = 0,\n    .bDeviceProtocol = 0,\n    .bMaxPacketSize0 = 64,\n    .idVendor = 0x18d1,\n    .idProduct = 0x0001,\n    .bcdDevice = 0x0001,\n    .iManufacturer = 0x01,\n    .iProduct = 0x02,\n    .iSerialNumber = 0x03,\n    .bNumConfigurations = 1\n};\n\nstatic struct usb_config_descriptor demo_config_desc = {\n    .bLength = USB_DT_CONFIG_SIZE,\n    .bDescriptorType = USB_DT_CONFIG,\n    .wTotalLength = 32, /* FIXME */\n    .bNumInterfaces = 1,\n    .bConfigurationValue = 1,\n    .iConfiguration = 0,\n    .bmAttributes = 0x80,\n    .bMaxPower = 0x64 /* 200mA */\n};\n\nstatic struct usb_interface_descriptor demo_intf_desc = {\n    .bLength = USB_DT_INTERFACE_SIZE,\n    .bDescriptorType = USB_DT_INTERFACE,\n    .bInterfaceNumber = 0x0,\n    .bAlternateSetting = 0x0,\n    .bNumEndpoints = 2,\n    .bInterfaceClass = 0x08, /* Mass Storage class */\n    .bInterfaceSubClass = 0x06, /* SCSI Transparent Subclass */\n    .bInterfaceProtocol = 0x50, /* Bulk-Only Protocol */\n    .iInterface = 0\n};\n\nstatic struct usb_endpoint_descriptor demo_ep_bulk_out = {\n    .bLength = USB_DT_ENDPOINT_SIZE,\n    .bDescriptorType = USB_DT_ENDPOINT,\n    .bEndpointAddress = 0x1 | USB_DIR_OUT,\n    .bmAttributes = USB_ENDPOINT_XFER_BULK,\n    .wMaxPacketSize = 0x0200, /* 512 Bytes */\n    .bInterval = 0\n};\n\nstatic struct usb_endpoint_descriptor demo_ep_bulk_in = {\n    .bLength = USB_DT_ENDPOINT_SIZE,\n    .bDescriptorType = USB_DT_ENDPOINT,\n    .bEndpointAddress = 0x1 | USB_DIR_IN,\n    .bmAttributes = USB_ENDPOINT_XFER_BULK,\n    .wMaxPacketSize = 0x0200, /* 512 Bytes */\n    .bInterval = 0\n};\n\n/*\n * String descriptors\n */\nstatic const uint16_t g_str_lang_id[] = {\n    0x0304, 0x0409\n};\n\nstatic const uint16_t g_str_manufacturer[] = {\n    0x030e, 'G', 'o', 'o', 'g', 'l', 'e'\n};\n\nstatic const uint16_t g_str_product[] = {\n    0x0308, 'M', 's', 'g'\n};\n\nstatic const uint16_t g_str_serialnumber[] = {\n    0x0314, '2', '0', '0', '8', '0', '4', '1', '1'\n};\n\nstruct usb_msg_dev g_msg_dev = {\n    .max_lun = 0,\n};\n\nstatic void *g_config_desc = NULL;\n\nvoid usb_msg_desc_init(void)\n{\n    uint32_t config_desc_len;\n    void *buf;\n\n    config_desc_len = demo_config_desc.bLength + demo_intf_desc.bLength\n            + demo_ep_bulk_out.bLength + demo_ep_bulk_in.bLength;\n\n    g_config_desc = malloc(config_desc_len);\n\n    /* compose configuation, interface and endpoint descriptors */\n    buf = g_config_desc;\n    memcpy(buf, &demo_config_desc, demo_config_desc.bLength);\n    buf += demo_config_desc.bLength;\n    memcpy(buf, &demo_intf_desc, demo_intf_desc.bLength);\n    buf += demo_intf_desc.bLength;\n    memcpy(buf, &demo_ep_bulk_out, demo_ep_bulk_out.bLength);\n    buf += demo_ep_bulk_out.bLength;\n    memcpy(buf, &demo_ep_bulk_in, demo_ep_bulk_in.bLength);\n\n    hal_udc_device_desc_init(&demo_device_desc);\n    hal_udc_config_desc_init(g_config_desc, config_desc_len);\n    /* FIXME: string descriptors must be initialized in the following order now */\n    hal_udc_string_desc_init(g_str_lang_id);\n    hal_udc_string_desc_init(g_str_manufacturer);\n    hal_udc_string_desc_init(g_str_product);\n    hal_udc_string_desc_init(g_str_serialnumber);\n}\n\nstatic void usb_msg_ep_init(void)\n{\n    hal_log_info(\"usb demo ep init...\\n\");\n\n    /* init bulk-in ep */\n    hal_udc_ep_enable(demo_ep_bulk_in.bEndpointAddress,\n            demo_ep_bulk_in.wMaxPacketSize,\n            demo_ep_bulk_in.bmAttributes & USB_ENDPOINT_XFERTYPE_MASK);\n\n    /* initialise bulk-out ep buf in order to get the first CBW */\n    hal_udc_ep_set_buf(demo_ep_bulk_out.bEndpointAddress,\n            g_msg_dev.cbw,\n            sizeof(g_msg_dev.cbw));\n\n    /* init bulk-out ep */\n    hal_udc_ep_enable(demo_ep_bulk_out.bEndpointAddress,\n            demo_ep_bulk_out.wMaxPacketSize,\n            demo_ep_bulk_out.bmAttributes & USB_ENDPOINT_XFERTYPE_MASK);\n}\n\nstatic udc_errno_t usb_msg_class_request_handler(struct usb_ctrlrequest *crq)\n{\n    udc_errno_t ret = UDC_ERRNO_SUCCESS;\n\n    switch(crq->bRequest) {\n    case US_BULK_RESET_REQUEST:\n        /* TODO */\n        break;\n    case US_BULK_GET_MAX_LUN:\n        hal_log_info(\"get MAX_LUN\\r\\n\");\n\n        if (crq->bRequestType !=\n                (USB_DIR_IN | USB_TYPE_CLASS | USB_RECIP_INTERFACE)) {\n            ret = UDC_ERRNO_CMD_INVALID;\n            break;\n        }\n        /* FIXME: a fake response for demo */\n        hal_udc_ep_write(0, &g_msg_dev.max_lun, sizeof(g_msg_dev.max_lun));\n        break;\n    default:\n        ret = UDC_ERRNO_CMD_INVALID;\n        break;\n    }\n\n    return ret;\n}\n\nstatic udc_errno_t usb_msg_standard_request_handler(struct usb_ctrlrequest *crq)\n{\n    udc_errno_t ret = UDC_ERRNO_SUCCESS;\n\n    switch (crq->bRequest) {\n    case USB_REQ_SET_CONFIGURATION:\n        /* FIXME: usb msg driver should be independent of demo code */\n        usb_msg_ep_init();\n        break;\n    default:\n        ret = UDC_ERRNO_CMD_INVALID;\n        break;\n    }\n\n    return ret;\n}\n\nstatic udc_errno_t usb_msg_scsi_cmd_handler(struct bulk_cb_wrap *cbw)\n{\n    udc_errno_t ret = UDC_ERRNO_SUCCESS;\n    uint8_t opcode = cbw->CDB[0];\n    uint8_t fake_rsp[36] = {0x00, 0x80, 0x02, 0x02, 0x1F, 0x00, 0x00,\n            0x00, 0x54, 0x69, 0x6e, 0x61, 0x20, 0x20, 0x20,\n            0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20,\n            0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20,\n            0x20, 0x20, 0x20, 0x20, 0x20};\n\n    hal_log_info(\"scsi cmd opcode: 0x%x\\n\", opcode);\n\n    switch (opcode) {\n    case 0x12: /* INQUIRY */\n        /* FIXME: a fake response for demo */\n        hal_udc_ep_write(demo_ep_bulk_in.bEndpointAddress, fake_rsp, sizeof(fake_rsp));\n        break;\n    default:\n        ret = UDC_ERRNO_CMD_INVALID;\n        break;\n    }\n\n    return ret;\n}\n\nudc_errno_t usb_msg_callback(uint8_t ep_addr, udc_callback_event_t event, void *data, uint32_t len)\n{\n    uint8_t ep_idx;\n    uint8_t is_in;\n    udc_errno_t ret = UDC_ERRNO_SUCCESS;\n    struct usb_ctrlrequest *crq;\n    struct bulk_cb_wrap *cbw;\n\n    hal_log_info(\"usb_msg_callback event: %\"PRIu32\", len: %\"PRIu32\"\\n\", event, len);\n\n    ep_idx = ep_addr & 0x7f;\n    is_in = ep_addr & USB_DIR_IN;\n\n    if (ep_idx == 0) { /* handle ep0 */\n        crq = (struct usb_ctrlrequest *)data;\n\n        switch (event) {\n        case UDC_EVENT_RX_STANDARD_REQUEST:\n            ret = usb_msg_standard_request_handler(crq);\n            break;\n        case UDC_EVENT_RX_CLASS_REQUEST:\n            ret = usb_msg_class_request_handler(crq);\n            break;\n        default:\n            ret = UDC_ERRNO_CMD_NOT_SUPPORTED;\n            break;\n        }\n    } else { /* handle ep1~4 */\n        if (is_in) {\n            /* TODO: maybe useless? */\n        } else {\n            cbw = (struct bulk_cb_wrap *)data;\n\n            switch (event) {\n            case UDC_EVENT_RX_DATA:\n                usb_msg_scsi_cmd_handler(cbw);\n                break;\n            default:\n                ret = UDC_ERRNO_CMD_NOT_SUPPORTED;\n                break;\n            }\n        }\n    }\n\n    return ret;\n}\n"})}),"\n",(0,s.jsx)(e.h3,{id:"phy-\u9a71\u52a8\u6d4b\u8bd5\u5b9e\u73b0",children:"PHY \u9a71\u52a8\u6d4b\u8bd5\u5b9e\u73b0"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-c",children:'#include "usb_test.h"\n\nstatic void __usb_ed_test(int port, const char *buf)\n{\n    if (usb_test_is_otg(port)) { /*otg mode*/\n#ifdef CONFIG_HAL_TEST_UDC\n        hal_udc_ed_test(buf, strlen(buf));\n#else\n        printf("ERR: udc config not find!\\n");\n#endif\n\n    } else {\n#ifdef CONFIG_HAL_TEST_HCI\n        hal_hci_ed_test(port, buf, strlen(buf));\n#else\n        printf("ERR: hci config not find!\\n");\n#endif\n    }\n}\n\nstatic void __phy_range_set(int port, int val)\n{\n    if (usb_test_is_otg(port)) { /*otg mode*/\n#ifdef CONFIG_HAL_TEST_UDC\n        hal_udc_phy_range_set(port, val);\n#else\n        printf("ERR: udc config not find!\\n");\n#endif\n    } else {\n#ifdef CONFIG_HAL_TEST_HCI\n        hal_hci_phy_range_set(port, val);\n#else\n        printf("ERR: hci config not find!\\n");\n#endif\n    }\n}\n\nstatic void __phy_range_show(int port)\n{\n    if (usb_test_is_otg(port)) { /*otg mode*/\n#ifdef CONFIG_HAL_TEST_UDC\n        hal_udc_phy_range_show(port);\n#else\n        printf("ERR: udc config not find!\\n");\n#endif\n    } else {\n#ifdef CONFIG_HAL_TEST_HCI\n        hal_hci_phy_range_show(port);\n#else\n        printf("ERR: hci config not find!\\n");\n#endif\n    }\n}\n\n\nint usb_test_cmd_ed_test(int argc, const char **argv)\n{\n    int port = 0;\n\n    if (argc != 4)\n        return -1;\n\n    if (usb_test_get_port(argv[2], &port))\n        return 0;\n\n    __usb_ed_test(port, argv[3]);\n    return 0;\n}\n\nint usb_test_cmd_phy_range(int argc, const char **argv)\n{\n    int c;\n    int val;\n    int port;\n\n    if ((argc != 4) && (argc != 5))\n        return -1;\n\n    if (usb_test_get_port(argv[3], &port))\n        return 0;\n\n    if (usb_test_is_otg(port)) {\n        printf("\\nOTG%d phy range\\n", port);\n    } else\n        printf("\\nEHCI%d phy range\\n", port);\n\n    while ((c = getopt(argc, (char *const *)argv, "sg")) != -1) {\n        switch (c) {\n        case \'s\':\n            if(argc == 5)\n                val = strtol(argv[4], NULL, 16);\n            else\n                return -1;\n\n            __phy_range_set(port, val);\n            break;\n        case \'g\':\n            __phy_range_show(port);\n            break;\n        default:\n            printf("ERR: phy_range cmd error!\\n");\n            usb_test_show_help();\n            break;\n        }\n    }\n    return 0;\n}\n'})}),"\n",(0,s.jsx)(e.h3,{id:"usb-udc-\u6d4b\u8bd5\u7528\u4f8b\u5b9e\u73b0",children:"USB UDC \u6d4b\u8bd5\u7528\u4f8b\u5b9e\u73b0"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-c",children:'#include "usb_test.h"\n\nint usb_test_cmd_udc(int argc, const char **argv)\n{\n    int c;\n    if ((argc != 3) && (argc != 4))\n        return -1;\n\n    while ((c = getopt(argc, (char *const *)argv, "ir")) != -1) {\n        switch (c) {\n        case \'i\':\n#ifdef CONFIG_HAL_TEST_HCI\n            // rmmod host driver before insmod otg\n            if (usb_test_is_otg(0) == 0) /*hci mode*/\n                hal_usb_hcd_deinit(0);\n#endif\n            printf("[usb0] insmod device driver!\\n");\n            hal_gadget_init();\n            break;\n        case \'r\':\n            printf("[usb0] rmmod device driver!\\n");\n            hal_gadget_exit();\n            break;\n        default:\n            printf("err: insmod/rmmod error!\\n");\n            usb_test_show_help();\n            break;\n        }\n    }\n\n    return 0;\n}\n'})}),"\n",(0,s.jsx)(e.h3,{id:"usb-uvc-\u6d4b\u8bd5\u7528\u4f8b\u5b9e\u73b0",children:"USB UVC \u6d4b\u8bd5\u7528\u4f8b\u5b9e\u73b0"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-c",children:'#include <sys/ioctl.h>\n#include <fcntl.h>\n\n#include "usb_test.h"\n#include "uvcvideo.h"\n\nstatic int save_frame_to_file(void *str, void *start, int length)\n{\n    FILE *fp = NULL;\n\n    fp = fopen(str, "wb+"); //save more frames\n    if (!fp) {\n        printf(" Open %s error\\n", (char *)str);\n\n        return -1;\n    }\n\n    if (fwrite(start, length, 1, fp)) {\n        fclose(fp);\n\n        return 0;\n    } else {\n        printf(" Write file fail (%s)\\n", strerror(errno));\n        fclose(fp);\n\n        return -1;\n    }\n\n    return 0;\n}\n\nint usb_test_cmd_uvc(int argc, const char **argv)\n{\n    int fd;\n    struct v4l2_capability cap;      /* Query device capabilities */\n    struct v4l2_streamparm parms;    /* set streaming parameters */\n    struct v4l2_format fmt;          /* try a format */\n    struct v4l2_requestbuffers req;  /* Initiate Memory Mapping or User Pointer I/O */\n    struct v4l2_buffer buf;          /* Query the status of a buffer */\n    enum v4l2_buf_type type;\n    int n_buffers;\n    char source_data_path[64];\n    int np;\n\n    /* 1.open /dev/videoX node */\n    fd = open("/dev/video", O_RDWR);\n\n    /* 2.Query device capabilities */\n    memset(&cap, 0, sizeof(cap));\n    if (ioctl(fd, VIDIOC_QUERYCAP, &cap) < 0) {\n        printf(" Query device capabilities fail!!!\\n");\n    } else {\n        printf(" Querey device capabilities succeed\\n");\n        printf(" cap.driver=%s\\n", cap.driver);\n        printf(" cap.card=%s\\n", cap.card);\n        printf(" cap.bus_info=%s\\n", cap.bus_info);\n        printf(" cap.version=0x%08x\\n", cap.version);\n        printf(" cap.capabilities=0x%08x\\n", cap.capabilities);\n    }\n\n    /* 7.set streaming parameters */\n    memset(&parms, 0, sizeof(struct v4l2_streamparm));\n    parms.type = V4L2_BUF_TYPE_VIDEO_CAPTURE;\n    parms.parm.capture.timeperframe.numerator = 1;\n    parms.parm.capture.timeperframe.denominator = 30;\n    if (ioctl(fd, VIDIOC_S_PARM, &parms) < 0) {\n        printf(" Setting streaming parameters failed, numerator:%d denominator:%d\\n",\n               parms.parm.capture.timeperframe.numerator,\n               parms.parm.capture.timeperframe.denominator);\n        close(fd);\n        return -1;\n    }\n\n    /* 9.set the data format */\n    memset(&fmt, 0, sizeof(struct v4l2_format));\n    fmt.type = V4L2_BUF_TYPE_VIDEO_CAPTURE;\n    fmt.fmt.pix.width = 1280;\n    fmt.fmt.pix.height = 720;\n    fmt.fmt.pix.pixelformat = V4L2_PIX_FMT_MJPEG;\n    fmt.fmt.pix.field = V4L2_FIELD_INTERLACED;\n\n    if (ioctl(fd, VIDIOC_S_FMT, &fmt) < 0) {\n        printf(" setting the data format failed!\\n");\n        close(fd);\n        return -1;\n    }\n\n    /* 10.Initiate Memory Mapping or User Pointer I/O */\n    memset(&req, 0, sizeof(struct v4l2_requestbuffers));\n    req.count = 3;\n    req.type = V4L2_BUF_TYPE_VIDEO_CAPTURE;\n    req.memory = V4L2_MEMORY_MMAP;\n    if (ioctl(fd, VIDIOC_REQBUFS, &req) < 0) {\n        printf(" VIDIOC_REQBUFS failed\\n");\n        close(fd);\n        return -1;\n    }\n\n    /* 11.Exchange a buffer with the driver */\n    for (n_buffers = 0; n_buffers < req.count; n_buffers++) {\n        memset(&buf, 0, sizeof(struct v4l2_buffer));\n\n        buf.index = n_buffers;\n        if (ioctl(fd, VIDIOC_QBUF, &buf) == -1) {\n            printf(" VIDIOC_QBUF error\\n");\n\n            close(fd);\n            return -1;\n        }\n    }\n\n    /* streamon */\n    type = V4L2_BUF_TYPE_VIDEO_CAPTURE;\n    if (ioctl(fd, VIDIOC_STREAMON, &type) == -1) {\n        printf(" VIDIOC_STREAMON error! %s\\n", strerror(errno));\n    } else\n        printf(" stream on succeed\\n");\n\n    np = 0;\n    while (np < 5) {\n        printf(" camera capture num is [%d]\\n", np);\n\n        /* wait uvc frame */\n        memset(&buf, 0, sizeof(struct v4l2_buffer));\n\n        if (ioctl(fd, VIDIOC_DQBUF, &buf) == -1) {\n            printf(" VIDIOC_DQBUF error\\n");\n\n            goto EXIT;\n        } else\n            printf("*****DQBUF[%d] FINISH*****\\n", buf.index);\n\n        sprintf(source_data_path, "/data/source_frame_%d.jpg", np);\n        save_frame_to_file(source_data_path, (void *)buf.mem_buf, buf.length);\n\n        if (ioctl(fd, VIDIOC_QBUF, &buf) == -1) {\n            printf(" VIDIOC_QBUF error\\n");\n\n            goto EXIT;\n        } else\n            printf("************QBUF[%d] FINISH**************\\n\\n", buf.index);\n\n        np++;\n    }\n\n    printf("\\n\\n Capture thread finish\\n");\n\nEXIT:\n    type = V4L2_BUF_TYPE_VIDEO_CAPTURE;\n    ioctl(fd, VIDIOC_STREAMOFF, &type);\n\n    memset(&req, 0, sizeof(struct v4l2_requestbuffers));\n    req.count = 0;\n    req.type = V4L2_BUF_TYPE_VIDEO_CAPTURE;\n    req.memory = V4L2_MEMORY_MMAP;\n    ioctl(fd, VIDIOC_REQBUFS, &req);\n\n    close(fd);\n\n    return 0;\n}\n'})}),"\n",(0,s.jsx)(e.h3,{id:"usb-\u6d4b\u8bd5\u7528\u4f8b",children:"USB \u6d4b\u8bd5\u7528\u4f8b"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-c",children:'#include "usb_test.h"\n\nvoid usb_test_show_help(void)\n{\n    printf("\\nUsage:\\n"\\\n        "\\tusb hci {-i|-r} [<port>]\\n"\\\n        "\\tusb udc {-i|-r} [<port>]\\n"\\\n        "\\tusb phy_range {-s|-g} {<port>} [<phyrange>]\\n"\\\n        "\\tusb ed_test {<port>} {<type>}\\n"\\\n        "\\tusb debug {<status>}\\n"\\\n        "\\tusb uvc_test\\n"\\\n        "\\n\\t- - - - - - - - - - - - - - - - - - - - -\\n"\\\n        "Meaning:\\n"\\\n        "\\t-i:insmod, -r:rmmod, -s:set, -g:get\\n"\\\n        "\\n"\\\n        "\\tport     : [0-%d],port number\\n"\\\n        "\\tphyrange : [0x0-0x1f],phy range\\n"\\\n        "\\tstatus   : [0-disable,1-enable],hci debug status\\n"\\\n        "\\ttype     : [test_j_state/test_k_state/test_se0_nak/test_pack]--hci & otg\\n"\\\n        "\\t           [test_not_operating/test_force_enable/test_mask]--hci only\\n"\\\n        "\\n\\t==>> More information refer to spec <<==\\n",\n        USB_MAX_CONTROLLER_COUNT - 1);\n}\n\nint usb_test_is_otg(int port)\n{\n#if defined(CONFIG_HAL_TEST_HCI)\n    if (port == 0 && !(sunxi_ehci_status_get() & 0x1)) /*otg mode*/\n#else\n    if (port == 0)\n#endif\n        return 1;\n    else\n        return 0;\n}\n\nint usb_test_get_port(const char *buf, int *port)\n{\n    *port = atoi(buf);\n    if (*port > USB_MAX_CONTROLLER_COUNT - 1) {\n        printf("ERR: port(%d) choose error! Port range [0-%d]\\n", *port,\n            USB_MAX_CONTROLLER_COUNT - 1);\n        return -1;\n    }\n\n    return 0;\n}\n\nstatic int usb_test_command_hci(int argc, const char **argv)\n{\n#if defined(CONFIG_HAL_TEST_HCI)\n    return usb_test_cmd_hci(argc, argv);\n#else\n    printf("ERR: Can\'t find command config!\\n");\n    return -1;\n#endif\n}\n\nstatic int usb_test_command_udc(int argc, const char **argv)\n{\n#if defined(CONFIG_HAL_TEST_UDC)\n    return usb_test_cmd_udc(argc, argv);\n#else\n    printf("ERR: Can\'t find command config!\\n");\n    return -1;\n#endif\n}\n\nstatic int usb_test_command_phy_range(int argc, const char **argv)\n{\n    return usb_test_cmd_phy_range(argc, argv);\n}\n\nstatic int usb_test_command_ed_test(int argc, const char **argv)\n{\n    return usb_test_cmd_ed_test(argc, argv);\n}\n\nstatic int usb_test_command_debug(int argc, const char **argv)\n{\n#if defined(CONFIG_HAL_TEST_HCI)\n    return usb_test_cmd_debug(argc, argv);\n#else\n    printf("ERR: Can\'t find command config!\\n");\n    return -1;\n#endif\n}\n\nstatic int usb_test_command_uvc(int argc, const char **argv)\n{\n#if defined(CONFIG_HAL_TEST_UVC)\n    // return usb_test_cmd_uvc(argc, argv);\n    usb_test_cmd_uvc(argc, argv);/* -1 has other meaning in this case*/\n    return 0;\n#else\n    printf("ERR: Can\'t find command config!\\n");\n    return -1;\n#endif\n}\n\nstatic int usb_test_command(int argc, const char **argv)\n{\n    int ret = -1;\n    if (argc < 2) {\n        printf("ERR: command error\\n");\n        usb_test_show_help();\n        return -1;\n    }\n\n    if (!strcmp(argv[1], "hci"))\n        ret = usb_test_command_hci(argc, argv);\n    else if (!strcmp(argv[1], "udc"))\n        ret = usb_test_command_udc(argc, argv);\n    else if (!strcmp(argv[1], "phy_range"))\n        ret = usb_test_command_phy_range(argc, argv);\n    else if (!strcmp(argv[1], "ed_test"))\n        ret = usb_test_command_ed_test(argc, argv);\n    else if (!strcmp(argv[1], "debug"))\n        ret = usb_test_command_debug(argc, argv);\n    else if (!strcmp(argv[1], "uvc_test"))\n        ret = usb_test_command_uvc(argc, argv);\n\n\n    if (ret == 0)\n        return 0;\n\n    usb_test_show_help();\n    return -1;\n}\n\nFINSH_FUNCTION_EXPORT_CMD(usb_test_command, usb, usb tests)\n'})})]})}function u(n={}){const{wrapper:e}={...(0,r.a)(),...n.components};return e?(0,s.jsx)(e,{...n,children:(0,s.jsx)(a,{...n})}):a(n)}},1151:(n,e,i)=>{i.d(e,{Z:()=>t,a:()=>d});var s=i(7294);const r={},c=s.createContext(r);function d(n){const e=s.useContext(c);return s.useMemo((function(){return"function"==typeof n?n(e):{...e,...n}}),[e,n])}function t(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(r):n.components||r:d(n.components),s.createElement(c.Provider,{value:e},n.children)}}}]);