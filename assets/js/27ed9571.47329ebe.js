"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[9352],{5911:(n,e,l)=>{l.r(e),l.d(e,{assets:()=>h,contentTitle:()=>i,default:()=>p,frontMatter:()=>d,metadata:()=>r,toc:()=>t});var a=l(5893),c=l(1151);const d={},i="GPADC",r={id:"developer-guide/part2/chapter6",title:"GPADC",description:"\u6a21\u5757\u4ecb\u7ecd",source:"@site/docs/developer-guide/part2/chapter6.md",sourceDirName:"developer-guide/part2",slug:"/developer-guide/part2/chapter6",permalink:"/developer-guide/part2/chapter6",draft:!1,unlisted:!1,editUrl:"https://github.com/100askTeam/R128-Docs/tree/main/docs/developer-guide/part2/chapter6.md",tags:[],version:"current",frontMatter:{},sidebar:"classpartoneSidebar",previous:{title:"Flash Controller",permalink:"/developer-guide/part2/chapter5"},next:{title:"GPIO",permalink:"/developer-guide/part2/chapter7"}},h={},t=[{value:"\u6a21\u5757\u4ecb\u7ecd",id:"\u6a21\u5757\u4ecb\u7ecd",level:2},{value:"\u6a21\u5757\u914d\u7f6e",id:"\u6a21\u5757\u914d\u7f6e",level:2},{value:"\u6e90\u7801\u7ed3\u6784",id:"\u6e90\u7801\u7ed3\u6784",level:2},{value:"\u6a21\u5757\u63a5\u53e3\u8bf4\u660e",id:"\u6a21\u5757\u63a5\u53e3\u8bf4\u660e",level:2},{value:"GPADC \u521d\u59cb\u5316\u63a5\u53e3",id:"gpadc-\u521d\u59cb\u5316\u63a5\u53e3",level:3},{value:"GPADC \u901a\u9053\u914d\u7f6e\u63a5\u53e3",id:"gpadc-\u901a\u9053\u914d\u7f6e\u63a5\u53e3",level:3},{value:"GPADC \u901a\u9053\u53d6\u6d88\u914d\u7f6e\u63a5\u53e3",id:"gpadc-\u901a\u9053\u53d6\u6d88\u914d\u7f6e\u63a5\u53e3",level:3},{value:"GPADC \u53bb\u521d\u59cb\u5316\u63a5\u53e3",id:"gpadc-\u53bb\u521d\u59cb\u5316\u63a5\u53e3",level:3},{value:"GPADC \u6ce8\u518c\u56de\u8c03\u63a5\u53e3",id:"gpadc-\u6ce8\u518c\u56de\u8c03\u63a5\u53e3",level:3},{value:"\u6a21\u5757\u4f7f\u7528\u8303\u4f8b",id:"\u6a21\u5757\u4f7f\u7528\u8303\u4f8b",level:2},{value:"\u8bfb\u53d6\u7535\u538b",id:"\u8bfb\u53d6\u7535\u538b",level:3},{value:"\u56de\u8c03\u65b9\u5f0f\u8bfb\u53d6\u7535\u538b",id:"\u56de\u8c03\u65b9\u5f0f\u8bfb\u53d6\u7535\u538b",level:3}];function s(n){const e={code:"code",h1:"h1",h2:"h2",h3:"h3",img:"img",li:"li",p:"p",pre:"pre",ul:"ul",...(0,c.a)(),...n.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(e.h1,{id:"gpadc",children:"GPADC"}),"\n",(0,a.jsx)(e.h2,{id:"\u6a21\u5757\u4ecb\u7ecd",children:"\u6a21\u5757\u4ecb\u7ecd"}),"\n",(0,a.jsx)(e.p,{children:"GPADC \u662f 12bit \u91c7\u96c6\u7cbe\u5ea6\u7684\u6a21\u6570\u8f6c\u6362\u6a21\u5757\uff0c\u652f\u6301 4 \u8def\u901a\u9053\uff0c\u6a21\u62df\u8f93\u5165\u8303\u56f4 0-1.8v\uff0c\u6700\u9ad8\u91c7\u6837\u7387 1MHZ\uff0c\u5e76\u4e14\u652f\u6301\u6570\u636e\u6bd4\u8f83\uff0c\u81ea\u6821\u9a8c\u529f\u80fd\uff0c\u540c\u65f6\u5de5\u4f5c\u4e8e\u53ef\u914d\u7f6e\u7684\u56db\u79cd\u5de5\u4f5c\u6a21\u5f0f\uff1a"}),"\n",(0,a.jsxs)(e.ul,{children:["\n",(0,a.jsx)(e.li,{children:"Single mode\uff1a\u5728\u6307\u5b9a\u7684\u901a\u9053\u5b8c\u6210\u4e00\u6b21\u8f6c\u6362\u5e76\u5c06\u6570\u636e\u653e\u5728\u54cd\u5e94\u6570\u636e\u5bc4\u5b58\u5668\u4e2d\uff1b"}),"\n",(0,a.jsx)(e.li,{children:"Single-cycle mode\uff1a\u5728\u6307\u5b9a\u7684\u901a\u9053\u5b8c\u6210\u4e00\u4e2a\u5468\u671f\u8f6c\u6362\u5e76\u5c06\u6570\u636e\u653e\u5728\u54cd\u5e94\u6570\u636e\u5bc4\u5b58\u5668\u4e2d\uff1b"}),"\n",(0,a.jsx)(e.li,{children:"Continuous mode\uff1a\u5728\u6307\u5b9a\u7684\u901a\u9053\u6301\u7eed\u8f6c\u6362\u5e76\u5c06\u6570\u636e\u653e\u5728\u54cd\u5e94\u6570\u636e\u5bc4\u5b58\u5668\u4e2d\uff1b"}),"\n",(0,a.jsx)(e.li,{children:"Burst mode\uff1a\u8fb9\u91c7\u6837\u8fb9\u8f6c\u6362\u5e76\u5c06\u6570\u636e\u653e\u5165 32 \u5b57\u8282\u7684 FIFO\uff0c\u652f\u6301\u4e2d\u65ad\u63a7\u5236\u3002"}),"\n"]}),"\n",(0,a.jsx)(e.p,{children:"\u4e00\u822c\u6765\u8bf4 GPADC \u63a5\u53e3\u7528\u4e8e KEY \u6a21\u5757\u6309\u952e\u7684\u8bfb\u53d6\uff0c\u4e00\u822c\u5305\u62ec VOL+\u3001VOL-\u3001HOME\u3001MENU\u3001ENTER \u7b49\u7b49\uff0cGPADC0 \u7528\u4e8e KEY \u7684\u7535\u8def\u5982\u4e0a\u56fe\u3002AVCC-AP \u4e3a 1.8V \u7684\u4f9b\u7535\uff0c\u4e0d\u540c\u7684\u6309\u952e\u6309\u4e0b\uff0cGPADC \u53e3\u7684\u7535\u538b\u4e0d\u540c\uff0cCPU \u901a\u8fc7\u5bf9\u8fd9\u4e2a\u7535\u538b\u7684\u91c7\u6837\u6765\u786e\u5b9a\u5177\u4f53\u662f\u90a3\u4e00\u4e2a\u6309\u952e\u6309\u4e0b\u3002\u5982\u4e0b\u56fe\uff0cVOL+\u3001VOL-\u3001MENU\u3001ENTER\u3001HOME\u5bf9\u5e94\u7684\u7535\u538b\u5206\u522b\u4e3a 0.21V\u30010.41V\u30010.59V\u30010.75V\u30010.88V\u3002"}),"\n",(0,a.jsx)(e.p,{children:(0,a.jsx)(e.img,{src:"http://photos.100ask.net/aw-r128-docs/rtos/developer-guide/part2/chapter6/image1.jpg",alt:"image1"})}),"\n",(0,a.jsx)(e.h2,{id:"\u6a21\u5757\u914d\u7f6e",children:"\u6a21\u5757\u914d\u7f6e"}),"\n",(0,a.jsx)(e.p,{children:"\u5176 menuconfig \u7684\u914d\u7f6e\u5982\u4e0b\uff1a"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{children:"Kernel Setup ---\x3e\n    Drivers Setup ---\x3e\n        SoC HAL Drivers ---\x3e\n            GPADC devices ---\x3e\n                [*] enable gpadc driver\n                [*] enbale gpadc hal APIs Test command\n"})}),"\n",(0,a.jsx)(e.h2,{id:"\u6e90\u7801\u7ed3\u6784",children:"\u6e90\u7801\u7ed3\u6784"}),"\n",(0,a.jsx)(e.p,{children:"GPADC \u6a21\u5757\u6e90\u7801\u7ed3\u6784\u5982\u4e0b\u6240\u793a\uff1a"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-c",children:"rtos-hal/\n|--hal/source/gpadc/hal_gpadc.c    // hal\u5c42\u63a5\u53e3\u4ee3\u7801\n|--include/hal/sunxi_hal_gpadc.h   // \u5934\u6587\u4ef6\n"})}),"\n",(0,a.jsx)(e.h2,{id:"\u6a21\u5757\u63a5\u53e3\u8bf4\u660e",children:"\u6a21\u5757\u63a5\u53e3\u8bf4\u660e"}),"\n",(0,a.jsx)(e.p,{children:"\u5934\u6587\u4ef6\uff1a"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-c",children:"#include <sunxi_hal_gpadc.h>\n"})}),"\n",(0,a.jsx)(e.h3,{id:"gpadc-\u521d\u59cb\u5316\u63a5\u53e3",children:"GPADC \u521d\u59cb\u5316\u63a5\u53e3"}),"\n",(0,a.jsx)(e.p,{children:"GPADC \u6a21\u5757\u521d\u59cb\u5316\uff0c\u4e3b\u8981\u521d\u59cb\u5316\u65f6\u949f\uff0c\u4e2d\u65ad\u4ee5\u53ca\u91c7\u6837\u7387\u914d\u7f6e\u7b49"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-c",children:"int hal_gpadc_init(void)\n"})}),"\n",(0,a.jsx)(e.p,{children:"\u53c2\u6570\uff1a"}),"\n",(0,a.jsxs)(e.ul,{children:["\n",(0,a.jsx)(e.li,{children:"\u65e0"}),"\n"]}),"\n",(0,a.jsx)(e.p,{children:"\u8fd4\u56de\u503c\uff1a"}),"\n",(0,a.jsxs)(e.ul,{children:["\n",(0,a.jsx)(e.li,{children:"0 \u4ee3\u8868\u6210\u529f"}),"\n",(0,a.jsx)(e.li,{children:"\u8d1f\u6570\u4ee3\u8868\u5931\u8d25"}),"\n"]}),"\n",(0,a.jsx)(e.h3,{id:"gpadc-\u901a\u9053\u914d\u7f6e\u63a5\u53e3",children:"GPADC \u901a\u9053\u914d\u7f6e\u63a5\u53e3"}),"\n",(0,a.jsx)(e.p,{children:"\u9009\u62e9\u5e76\u914d\u7f6e GPADC \u67d0\u4e2a\u901a\u9053"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-c",children:"hal_gpadc_status_t hal_gpadc_channel_init(hal_gpadc_channel_t channal)\n"})}),"\n",(0,a.jsx)(e.p,{children:"\u53c2\u6570\uff1a"}),"\n",(0,a.jsxs)(e.ul,{children:["\n",(0,a.jsx)(e.li,{children:"channel\uff1a\u901a\u9053\u53f7"}),"\n"]}),"\n",(0,a.jsx)(e.p,{children:"\u8fd4\u56de\u503c\uff1a"}),"\n",(0,a.jsxs)(e.ul,{children:["\n",(0,a.jsx)(e.li,{children:"0 \u4ee3\u8868\u6210\u529f"}),"\n",(0,a.jsx)(e.li,{children:"\u8d1f\u6570\u4ee3\u8868\u5931\u8d25"}),"\n"]}),"\n",(0,a.jsx)(e.h3,{id:"gpadc-\u901a\u9053\u53d6\u6d88\u914d\u7f6e\u63a5\u53e3",children:"GPADC \u901a\u9053\u53d6\u6d88\u914d\u7f6e\u63a5\u53e3"}),"\n",(0,a.jsx)(e.p,{children:"\u53d6\u6d88 GPADC \u67d0\u4e2a\u901a\u9053\u914d\u7f6e"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-c",children:"hal_gpadc_status_t hal_gpadc_channel_exit(hal_gpadc_channel_t channal)\n"})}),"\n",(0,a.jsx)(e.p,{children:"\u53c2\u6570\uff1a"}),"\n",(0,a.jsxs)(e.ul,{children:["\n",(0,a.jsx)(e.li,{children:"channel\uff1a\u901a\u9053\u53f7"}),"\n"]}),"\n",(0,a.jsx)(e.p,{children:"\u8fd4\u56de\u503c\uff1a"}),"\n",(0,a.jsxs)(e.ul,{children:["\n",(0,a.jsx)(e.li,{children:"0 \u4ee3\u8868\u6210\u529f"}),"\n",(0,a.jsx)(e.li,{children:"\u8d1f\u6570\u4ee3\u8868\u5931\u8d25"}),"\n"]}),"\n",(0,a.jsx)(e.h3,{id:"gpadc-\u53bb\u521d\u59cb\u5316\u63a5\u53e3",children:"GPADC \u53bb\u521d\u59cb\u5316\u63a5\u53e3"}),"\n",(0,a.jsx)(e.p,{children:"GPADC \u6a21\u5757\u53bb\u521d\u59cb\u5316"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-c",children:"hal_gpadc_status_t hal_gpadc_deinit(void)\n"})}),"\n",(0,a.jsx)(e.p,{children:"\u53c2\u6570\uff1a"}),"\n",(0,a.jsxs)(e.ul,{children:["\n",(0,a.jsx)(e.li,{children:"\u65e0"}),"\n"]}),"\n",(0,a.jsx)(e.p,{children:"\u8fd4\u56de\u503c\uff1a"}),"\n",(0,a.jsxs)(e.ul,{children:["\n",(0,a.jsx)(e.li,{children:"0 \u4ee3\u8868\u6210\u529f"}),"\n",(0,a.jsx)(e.li,{children:"\u8d1f\u6570\u4ee3\u8868\u5931\u8d25"}),"\n"]}),"\n",(0,a.jsx)(e.h3,{id:"gpadc-\u6ce8\u518c\u56de\u8c03\u63a5\u53e3",children:"GPADC \u6ce8\u518c\u56de\u8c03\u63a5\u53e3"}),"\n",(0,a.jsx)(e.p,{children:"\u5411\u5e94\u7528\u5c42\u63d0\u4f9b\u6ce8\u518c\u56de\u8c03\u63a5\u53e3\u7684\u529f\u80fd"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-c",children:"hal_gpadc_status_t hal_gpadc_register_callback(hal_gpadc_channel_t channal, gpadc_callback_t user_callback)\n"})}),"\n",(0,a.jsx)(e.p,{children:"\u53c2\u6570\uff1a"}),"\n",(0,a.jsxs)(e.ul,{children:["\n",(0,a.jsx)(e.li,{children:"channel\uff1a\u901a\u9053\u53f7"}),"\n",(0,a.jsx)(e.li,{children:"user_callback\uff1a\u5e94\u7528\u5c42\u56de\u8c03\u63a5\u53e3"}),"\n"]}),"\n",(0,a.jsx)(e.p,{children:"\u8fd4\u56de\u503c\uff1a"}),"\n",(0,a.jsxs)(e.ul,{children:["\n",(0,a.jsx)(e.li,{children:"0 \u4ee3\u8868\u6210\u529f"}),"\n",(0,a.jsx)(e.li,{children:"\u8d1f\u6570\u4ee3\u8868\u5931\u8d25"}),"\n"]}),"\n",(0,a.jsx)(e.h2,{id:"\u6a21\u5757\u4f7f\u7528\u8303\u4f8b",children:"\u6a21\u5757\u4f7f\u7528\u8303\u4f8b"}),"\n",(0,a.jsx)(e.h3,{id:"\u8bfb\u53d6\u7535\u538b",children:"\u8bfb\u53d6\u7535\u538b"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-c",children:'#include <stdio.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <string.h>\n#include <unistd.h>\n\n#include <hal_log.h>\n#include <hal_cmd.h>\n#include <sunxi_hal_gpadc.h>\n\nint channel = -1;\n\nint cmd_test_gpadc(int argc, char **argv)\n{\n    int ret = -1;\n    uint32_t vol_data;\n\n    printf("Run gpadc test\\n");\n\n    if (argc < 2)\n    {\n        hal_log_err("usage: hal_gpadc channel\\n");\n        return -1;\n    }\n\n    ret = hal_gpadc_init();\n    if (ret) {\n        hal_log_err("gpadc init failed!\\n");\n        return -1;\n    }\n\n    channel = strtol(argv[1], NULL, 0);\n\n    if (channel < 0 || channel > CHANNEL_NUM)\n    {\n        hal_log_err("channel %d is wrong, must between 0 and %d\\n", CHANNEL_NUM);\n        return -1;\n    }\n\n    hal_gpadc_channel_init(channel);\n    vol_data = gpadc_read_channel_data(channel);\n    printf("channel %d vol data is %u\\n", channel, vol_data);\n    hal_gpadc_channel_exit(channel);\n    hal_gpadc_deinit();\n\n    return 0;\n}\n\nFINSH_FUNCTION_EXPORT_CMD(cmd_test_gpadc, hal_gpadc, gpadc hal APIs tests)\n'})}),"\n",(0,a.jsx)(e.h3,{id:"\u56de\u8c03\u65b9\u5f0f\u8bfb\u53d6\u7535\u538b",children:"\u56de\u8c03\u65b9\u5f0f\u8bfb\u53d6\u7535\u538b"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-c",children:'#include <stdio.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <string.h>\n#include <unistd.h>\n\n#include <hal_log.h>\n#include <hal_cmd.h>\n#include <sunxi_hal_gpadc.h>\n\nint channel = -1;\n\nint sunxigpadc_irq_callback(uint32_t dada_type, uint32_t data)\n{\n    int vol_data;\n    data = ((VOL_RANGE / 4096) * data);\n    vol_data = data / 1000;\n    printf("channel %d vol data: %d\\n", channel, vol_data);\n    hal_gpadc_channel_exit(channel);\n    hal_gpadc_deinit();\n    return 0;\n}\n\nint cmd_test_gpadc_callback(int argc, char **argv)\n{\n    int ret = -1;\n    uint32_t vol_data;\n\n    printf("Run gpadc test\\n");\n\n    if (argc < 2)\n    {\n        hal_log_err("usage: hal_gpadc channel\\n");\n        return -1;\n    }\n\n    ret = hal_gpadc_init();\n    if (ret) {\n        hal_log_err("gpadc init failed!\\n");\n        return -1;\n    }\n\n    channel = strtol(argv[1], NULL, 0);\n\n    if (channel < 0 || channel > CHANNEL_NUM)\n    {\n        hal_log_err("channel %d is wrong, must between 0 and %d\\n", CHANNEL_NUM);\n        return -1;\n    }\n\n    hal_gpadc_channel_init(channel);\n    hal_gpadc_register_callback(channel, sunxigpadc_irq_callback);\n\n    return 0;\n}\n\nFINSH_FUNCTION_EXPORT_CMD(cmd_test_gpadc_callback, hal_gpadc callback, gpadc hal APIs tests callback)\n'})})]})}function p(n={}){const{wrapper:e}={...(0,c.a)(),...n.components};return e?(0,a.jsx)(e,{...n,children:(0,a.jsx)(s,{...n})}):s(n)}},1151:(n,e,l)=>{l.d(e,{Z:()=>r,a:()=>i});var a=l(7294);const c={},d=a.createContext(c);function i(n){const e=a.useContext(d);return a.useMemo((function(){return"function"==typeof n?n(e):{...e,...n}}),[e,n])}function r(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(c):n.components||c:i(n.components),a.createElement(d.Provider,{value:e},n.children)}}}]);