"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[1606],{1124:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>s,contentTitle:()=>c,default:()=>l,frontMatter:()=>d,metadata:()=>o,toc:()=>i});var a=r(5893),t=r(1151);const d={},c="\u5185\u5b58\u6cc4\u9732\u8c03\u8bd5\u6848\u4f8b",o={id:"developer-guide/part4/chapter1",title:"\u5185\u5b58\u6cc4\u9732\u8c03\u8bd5\u6848\u4f8b",description:"\u95ee\u9898\u80cc\u666f",source:"@site/docs/developer-guide/part4/chapter1.md",sourceDirName:"developer-guide/part4",slug:"/developer-guide/part4/chapter1",permalink:"/en/developer-guide/part4/chapter1",draft:!1,unlisted:!1,editUrl:"https://github.com/100askTeam/R128-Docs/tree/main/docs/developer-guide/part4/chapter1.md",tags:[],version:"current",frontMatter:{},sidebar:"classpartoneSidebar",previous:{title:"\u8c03\u8bd5\u6307\u5357",permalink:"/en/category/\u8c03\u8bd5\u6307\u5357"},next:{title:"\u4f7f\u7528 VSCode \u8c03\u8bd5",permalink:"/en/developer-guide/part4/chapter2"}},s={},i=[{value:"\u95ee\u9898\u80cc\u666f",id:"\u95ee\u9898\u80cc\u666f",level:2},{value:"\u95ee\u9898\u590d\u73b0",id:"\u95ee\u9898\u590d\u73b0",level:2},{value:"\u5177\u4f53\u8868\u73b0",id:"\u5177\u4f53\u8868\u73b0",level:2},{value:"\u95ee\u9898\u5206\u6790",id:"\u95ee\u9898\u5206\u6790",level:2},{value:"\u6cc4\u6f0f\u70b9\u5b9a\u4f4d",id:"\u6cc4\u6f0f\u70b9\u5b9a\u4f4d",level:3},{value:"\u6839\u672c\u539f\u56e0",id:"\u6839\u672c\u539f\u56e0",level:2},{value:"\u89e3\u51b3\u65b9\u6cd5",id:"\u89e3\u51b3\u65b9\u6cd5",level:2}];function x(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",...(0,t.a)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(n.h1,{id:"\u5185\u5b58\u6cc4\u9732\u8c03\u8bd5\u6848\u4f8b",children:"\u5185\u5b58\u6cc4\u9732\u8c03\u8bd5\u6848\u4f8b"}),"\n",(0,a.jsx)(n.h2,{id:"\u95ee\u9898\u80cc\u666f",children:"\u95ee\u9898\u80cc\u666f"}),"\n",(0,a.jsx)(n.p,{children:"\u786c\u4ef6\uff1aR128 \u8f6f\u4ef6\uff1aFreeRTOS + rtplayer_test(Cedarx)+ AudioSystem"}),"\n",(0,a.jsx)(n.h2,{id:"\u95ee\u9898\u590d\u73b0",children:"\u95ee\u9898\u590d\u73b0"}),"\n",(0,a.jsx)(n.p,{children:"\u590d\u73b0\u6b65\u9aa4\uff1a"}),"\n",(0,a.jsxs)(n.ol,{children:["\n",(0,a.jsx)(n.li,{children:"rtplayer_test /data/boot.mp3"}),"\n",(0,a.jsx)(n.li,{children:'\u4e32\u53e3\u8f93\u5165"l", \u5faa\u73af\u64ad\u653e'}),"\n",(0,a.jsx)(n.li,{children:'\u4e32\u53e3\u8f93\u5165"b" , \u64ad\u653e\u5668\u540e\u53f0\u6267\u884c'}),"\n"]}),"\n",(0,a.jsx)(n.h2,{id:"\u5177\u4f53\u8868\u73b0",children:"\u5177\u4f53\u8868\u73b0"}),"\n",(0,a.jsx)(n.p,{children:"rtplayer_test \u5faa\u73af\u64ad\u653e\u8001\u5316\u97f3\u9891\u5341\u51e0\u5206\u949f\u540e\uff0c\u97f3\u4e50\u505c\u6b62\u64ad\u653e\uff0c\u62a5\u9519\u5982\u4e0b\uff1a"}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.img,{src:"http://photos.100ask.net/aw-r128-docs/rtos/developer-guide/part4/chapter1/image1.jpg",alt:"image1"})}),"\n",(0,a.jsx)(n.h2,{id:"\u95ee\u9898\u5206\u6790",children:"\u95ee\u9898\u5206\u6790"}),"\n",(0,a.jsxs)(n.ol,{children:["\n",(0,a.jsx)(n.li,{children:"\u6839\u636e\u4e0a\u9762\u62a5\u9519\u7684log,\u64ad\u653e\u505c\u6b62\u65f6\uff0c\u7cfb\u7edf\u5185\u5b58\u4e0d\u8db3\uff1b\u5728\u8001\u5316\u8fc7\u7a0b\u4e2d\u51fa\u73b0\u7684\u5185\u5b58\u4e0d\u8db3\uff0c\u4e00\u822c\u662f\u67d0\u5904\u5b58\u5728\u5185\u5b58\u6cc4\u6f0f"}),"\n",(0,a.jsx)(n.li,{children:"reboot\u91cd\u542f\uff0c\u91cd\u65b0\u6267\u884c\u8001\u5316\u64ad\u653e\u6d41\u7a0b\uff0c\u4e32\u53e3\u6267\u884cfree\u547d\u4ee4\uff0c\u89c2\u5bdf\u5185\u5b58\u7684\u5269\u4f59\u60c5\u51b5\uff1a"}),"\n"]}),"\n",(0,a.jsx)(n.p,{children:"\u9996\u6b21\u64ad\u653e\u65f6\u7684\u5185\u5b58\uff1a"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{children:"c906>free\n==> Round [1] <==\nTotal Heap Size :  1907128 Bytes    ( 1862 KB)\n           Free :   547632 Bytes    (  534 KB)\n       Min Free :   536208 Bytes    (  523 KB)\n\n\n      List Task MIN Free Stack(unit: word)\nTask          State  Priority  Stack      #\n************************************************\nName            State   Pri     HWM     Idx     StkCur          StkBot\nadb-shell       X       4       394     44      0x87233a0       0x8722650\nAudioDecode     R       4       3872    49      0x874d2c0       0x87459c0\nIDLE            R       0       52      2       0x863dfe0       0x863de40\ntcpip           B       3       470     12      0x8677ae0       0x8676c30\nDemux           B       6       3126    47      0x87333a0       0x872b960\nusb-hardware-sc B       6       8018    14      0x871a3a0       0x870a630\nadbd-input      B       5       900     24      0x876eb90       0x876cec0\namp-admin       B       6       4002    11      0x8675ab0       0x866dda0\nAudioMT2pb      B       4       3882    52      0x8779be0       0x8772050\nAudioRender     B       6       3350    50      0x8756950       0x874ed30\namp-ser2        B       6       4006    8       0x865d830       0x8655b00\namp-ser3        B       6       4006    9       0x8665910       0x865dbe0\namp-ser4        B       6       4006    10      0x866d9f0       0x8665cc0\nhub-main-thread B       6       8082    13      0x870a2b0       0x86fa620\nadbd-shell-ser- B       4       906     45      0x8726330       0x8724660\nXPlayer         B       4       3912    48      0x8744e10       0x873d220\nAudioMT2        B       4       1907    18      0x873cb00       0x8738e10\nRTplayerThread  B       4       3989    51      0x876a630       0x8762980\nCLI             B       6       3772    15      0x8722060       0x871a640\nTmr Svc         B       6       374     3       0x863f070       0x863e320\namp-send-task   B       6       930     4       0x8642db0       0x8641070\namp-recv-task   B       6       924     5       0x8644e90       0x8643150\nadbd-output     B       5       843     25      0x8770cd0       0x876f060\nadb-event       B       5       894     46      0x872a300       0x87286d0\namp-ser0        B       6       4006    6       0x864d670       0x8645940\namp-ser1        B       6       4006    7       0x8655750       0x864da20\n"})}),"\n",(0,a.jsx)(n.p,{children:"\u64ad\u653e\u51e0\u6b21\u540e\u7684\u5185\u5b58\u60c5\u51b5\uff1a"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-language",children:"c906>free\n==> Round [1] <==\nTotal Heap Size :  1907128 Bytes    ( 1862 KB)\n           Free :   456992 Bytes    (  446 KB)\n       Min Free :   453440 Bytes    (  442 KB)\n\n\n      List Task MIN Free Stack(unit: word)\nTask          State  Priority  Stack      #\n************************************************\nName            State   Pri     HWM     Idx     StkCur          StkBot\nadb-shell       X       4       394     44      0x87235b0       0x8722650\nAudioDecode     R       4       3872    49      0x874d5e0       0x87459c0\nIDLE            R       0       52      2       0x863dfe0       0x863de40\ntcpip           B       3       458     12      0x8677ae0       0x8676c30\nusb-hardware-sc B       6       8018    14      0x871a3a0       0x870a630\nadbd-input      B       5       900     24      0x876eb90       0x876cec0\namp-admin       B       6       4002    11      0x8675ab0       0x866dda0\nAudioMT2pb      B       4       3882    52      0x8779be0       0x8772050\nAudioRender     B       6       3350    50      0x8756950       0x874ed30\nCLI             B       6       3772    15      0x8722060       0x871a640\nTmr Svc         B       6       374     3       0x863f070       0x863e320\namp-ser0        B       6       4006    6       0x864d670       0x8645940\namp-ser1        B       6       4006    7       0x8655750       0x864da20\namp-ser2        B       6       4006    8       0x865d830       0x8655b00\namp-ser3        B       6       4006    9       0x8665910       0x865dbe0\namp-ser4        B       6       4006    10      0x866d9f0       0x8665cc0\nhub-main-thread B       6       8082    13      0x870a2b0       0x86fa620\nXPlayer         B       4       3912    48      0x8744e10       0x873d220\nAudioMT2        B       4       1907    18      0x873cb00       0x8738e10\nadbd-output     B       5       843     25      0x8770cd0       0x876f060\namp-recv-task   B       6       924     5       0x8644e90       0x8643150\nDemux           B       6       3126    47      0x8733150       0x872b960\namp-send-task   B       6       924     4       0x8642db0       0x8641070\nadb-event       B       5       890     46      0x872a2a0       0x87286d0\nadbd-shell-ser- B       4       906     45      0x8726330       0x8724660\nRTplayerThread  B       4       3989    51      0x876a630       0x8762980\n"})}),"\n",(0,a.jsx)(n.p,{children:"\u89c2\u5bdfFree\u9879\u7684\u5269\u4f59\u5185\u5b58\uff0c\u53ef\u53d1\u73b0\u5728\u8001\u5316\u64ad\u653e\u8fc7\u7a0b\u4e2d\uff0c\u5185\u5b58\u4e0d\u65ad\u51cf\u5c11\uff0c\u5b58\u5728\u6cc4\u6f0f\u3002"}),"\n",(0,a.jsx)(n.h3,{id:"\u6cc4\u6f0f\u70b9\u5b9a\u4f4d",children:"\u6cc4\u6f0f\u70b9\u5b9a\u4f4d"}),"\n",(0,a.jsx)(n.p,{children:"\u53ef\u501f\u52a9memleak\u5de5\u5177\uff0c\u5b9a\u4f4d\u5185\u5b58\u6cc4\u6f0f\u5904\u3002mrtos menuconfig\u9009\u4e0amemleak"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{children:"-> System components                                                                    \n -> aw components                                                                         \n  -> Memleak Components Support   \n    [*] Tina RTOS Memleak                    # \u4f7f\u80fd\u5185\u5b58\u6cc4\u9732\u5206\u6790\u5de5\u5177\n    (16)  Tina RTOS Memleak Backtrace Level  # \u5185\u5b58\u6cc4\u9732\u5206\u6790\u6808\u56de\u6eaf\u5c42\u6570                 \n    [ ]   Tina RTOS Double Free Check                                                     \n"})}),"\n",(0,a.jsx)(n.p,{children:"memleak\u7528\u6cd5\u5982\u4e0b"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-language",children:"\u4f5c\u7528\uff1a\u5185\u5b58\u6cc4\u9732\u5206\u6790\n\u7528\u6cd5\uff1amemleak 1 \u4f7f\u80fd\u5185\u5b58\u6cc4\u9732\u5206\u6790\uff0c\u8bb0\u5f55\u6240\u6709\u5185\u5b58\u5757\u7533\u8bf7\u3001\u91ca\u653e\u4fe1\u606f\nmemleak 0 \u5173\u95ed\u5185\u5b58\u6cc4\u9732\u5206\u6790\uff0c\u5220\u9664\u6240\u6709\u5185\u5b58\u5757\u7684\u7533\u8bf7\u3001\u91ca\u653e\u4fe1\u606f\nmemleak 1 thread_name1 thread_name2 \u4f7f\u80fd\u5185\u5b58\u6cc4\u9732\u5206\u6790\uff0c\u8bb0\u5f55\u6307\u5b9a\u4efb\u52a1\u7684\u5185\u5b58\u5757\u7533\u8bf7\u3001\u91ca\u653e\u4fe1\u606f\n"})}),"\n",(0,a.jsx)(n.p,{children:"\u4e32\u53e3\u6267\u884cmemleak 1"}),"\n",(0,a.jsx)(n.p,{children:"\u97f3\u9891\u8001\u5316\u6d4b\u8bd5\uff08\u53c2\u8003\u590d\u73b0\u6b65\u9aa4\uff09\uff0c\u97f3\u9891\u64ad\u653e\u51e0\u6b21\u540e\uff0c\u6267\u884crtpc q \u547d\u4ee4\u9000\u51fa\u64ad\u653e"}),"\n",(0,a.jsx)(n.p,{children:"\u4e32\u53e3\u6267\u884cmemleak 0"}),"\n",(0,a.jsx)(n.p,{children:"\u5173\u95ed\u5185\u5b58\u6cc4\u9732\u68c0\u6d4b\u65f6\uff0c\u4f1a\u6253\u5370\u53ef\u7591\u7684\u5185\u5b58\u6cc4\u9732\u70b9\u53ca\u5176\u56de\u6eaf\u4fe1\u606f;"}),"\n",(0,a.jsx)(n.p,{children:"\u6709\u4e24\u4e2a\u5730\u65b9\uff1a"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{children:"    007: ptr = 0x08760960, size = 0x00000f00, thread = AudioRender\n        backtrace : 0x08336AEE\n        backtrace : 0x08336B46\n        backtrace : 0x08396D52\n        backtrace : 0x084B025E\n        backtrace : 0x08446856\n        backtrace : 0x084496C6\n    008: ptr = 0x0875f990, size = 0x00000f00, thread = AudioRender\n        backtrace : 0x08336AEE\n        backtrace : 0x08336B46\n        backtrace : 0x0839757E\n        backtrace : 0x084B025E\n        backtrace : 0x08446856\n        backtrace : 0x084496C6\n"})}),"\n",(0,a.jsx)(n.p,{children:"callstack \u56de\u6eaf"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{children:"pvPortMalloc at /workspace/freertos/r128/test_0624_rtplayer/rtos-dev/lichee/rtos/kernel/FreeRTOS-orig/Source/portable/MemMang/heap_4.c:658\npvPortCalloc at /workspace/freertos/r128/test_0624_rtplayer/rtos-dev/lichee/rtos/kernel/FreeRTOS-orig/Source/portable/MemMang/heap_4.c:577\nsoftvol_ap_update_mode at /workspace/freertos/r128/test_0624_rtplayer/rtos-dev/lichee/rtos/components/common/aw/AudioSystem/audio_plugin/softvolume.c:250\n_AudioTrackStart at //workspace/rtos-r128/lichee/rtos/components/common/aw/AudioSystem/AudioTrack.c:163\nRTSoundDeviceStart at /workspace/codec_lib/cedarx_rtos/temp/rtos_cedarx/cedarx/rtos_out/libcore/playback/src/rtosSoundControl.c:766\nstartSoundDevice at /workspace/codec_lib/cedarx_rtos/temp/rtos_cedarx/cedarx/rtos_out/libcore/playback/src/audioRenderComponent.c:800\n (inlined by) doRender at /workspace/codec_lib/cedarx_rtos/temp/rtos_cedarx/cedarx/rtos_out/libcore/playback/src/audioRenderComponent.c:942\n (inlined by) doRender at /workspace/codec_lib/cedarx_rtos/temp/rtos_cedarx/cedarx/rtos_out/libcore/playback/src/audioRenderComponent.c:898\n"})}),"\n",(0,a.jsxs)(n.p,{children:["\u901a\u8fc7\u56de\u6eaf\u4fe1\u606f\uff0c\u53d1\u73b0\u5728",(0,a.jsx)(n.code,{children:"resample_ap_update_mode"}),"\u5904\u4ea7\u751f\u4e86\u5185\u5b58\u6cc4\u6f0f\u3002"]}),"\n",(0,a.jsx)(n.h2,{id:"\u6839\u672c\u539f\u56e0",children:"\u6839\u672c\u539f\u56e0"}),"\n",(0,a.jsxs)(n.p,{children:["\u64ad\u653e\u5668\u8001\u5316\u8fc7\u7a0b\u4e2d\uff0c\u53ea\u8c03\u7528",(0,a.jsx)(n.code,{children:"AudioTrackCreate"}),"\u4e00\u6b21\uff0c\u5faa\u73af\u64ad\u653e\u65f6\u4f1a\u591a\u6b21\u8c03\u7528",(0,a.jsx)(n.code,{children:"_AudioTrackStart"}),"\uff0c\u6700\u540e\u9000\u51fa\u64ad\u653e\u624d\u8c03\u7528",(0,a.jsx)(n.code,{children:"AudioTrackDestroy"}),"\u9500\u6bc1\uff1b\u6240\u4ee5",(0,a.jsx)(n.code,{children:"softvol_ap_update_mode"}),"\u8fd9\u91cc\uff0c\u8001\u5316\u8fc7\u7a0b\u4f1a\u591a\u6b21\u8c03\u7528\u5230\uff0c\u4f1a\u6709\u591a\u6b21\u5206\u914d\uff0c\u4f46\u53ea\u5728\u9000\u51fa\u65f6",(0,a.jsx)(n.code,{children:"AudioTrackDestroy"}),"\u91cc\u624d\u9500\u6bc1\u3002"]}),"\n",(0,a.jsx)(n.h2,{id:"\u89e3\u51b3\u65b9\u6cd5",children:"\u89e3\u51b3\u65b9\u6cd5"}),"\n",(0,a.jsxs)(n.p,{children:["\u53ea\u5728",(0,a.jsx)(n.code,{children:"AudioTrackCreateWithStream"}),"\u65f6\u521b\u5efa\u4e00\u6b21\uff0c",(0,a.jsx)(n.code,{children:"AudioTrackDestroy"}),"\uff0c\u6d4b\u8bd510\u5c0f\u65f6\u5de6\u53f3\u672a\u51fa\u73b0\u5185\u5b58\u6cc4\u6f0f"]}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.img,{src:"http://photos.100ask.net/aw-r128-docs/rtos/developer-guide/part4/chapter1/image2.jpg",alt:"image2"})})]})}function l(e={}){const{wrapper:n}={...(0,t.a)(),...e.components};return n?(0,a.jsx)(n,{...e,children:(0,a.jsx)(x,{...e})}):x(e)}},1151:(e,n,r)=>{r.d(n,{Z:()=>o,a:()=>c});var a=r(7294);const t={},d=a.createContext(t);function c(e){const n=a.useContext(d);return a.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:c(e.components),a.createElement(d.Provider,{value:n},e.children)}}}]);