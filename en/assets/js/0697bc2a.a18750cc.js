"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[3653],{4649:(e,r,n)=>{n.r(r),n.d(r,{assets:()=>s,contentTitle:()=>t,default:()=>p,frontMatter:()=>d,metadata:()=>l,toc:()=>o});var i=n(5893),c=n(1151);const d={},t="RTOS \u591a\u5a92\u4f53\u7f16\u7801",l={id:"developer-guide/part1/chapter2",title:"RTOS \u591a\u5a92\u4f53\u7f16\u7801",description:"\u4ecb\u7ecd FreeRTOS \u4e0b\u5982\u4f55\u4f7f\u7528 xrecorder \u7684\u63a5\u53e3\u6765\u5f00\u53d1\u5f55\u5236\u5e94\u7528\u7a0b\u5e8f\uff0c\u65b9\u4fbf\u5f55\u5236\u5e94\u7528\u5f00\u53d1\u4eba\u5458\u5feb\u901f\u6b63\u786e\u5730\u5f00\u53d1\uff0c\u4ee5\u53ca\u5f55\u5236\u5e94\u7528\u6d4b\u8bd5\u4eba\u5458\u5982\u4f55\u6839\u636e\u8be5\u6587\u6863\u5bf9\u57fa\u4e8e xrecord \u7684\u5f55\u5236\u5e94\u7528\u8fdb\u884c\u9a8c\u8bc1\u6d4b\u8bd5\u3002",source:"@site/docs/developer-guide/part1/chapter2.md",sourceDirName:"developer-guide/part1",slug:"/developer-guide/part1/chapter2",permalink:"/en/developer-guide/part1/chapter2",draft:!1,unlisted:!1,editUrl:"https://github.com/100askTeam/R128-Docs/tree/main/docs/developer-guide/part1/chapter2.md",tags:[],version:"current",frontMatter:{},sidebar:"classpartoneSidebar",previous:{title:"RTOS \u5b58\u50a8\u7b80\u4ecb",permalink:"/en/developer-guide/part1/chapter12"},next:{title:"\u97f3\u9891\u6846\u67b6",permalink:"/en/developer-guide/part1/chapter3"}},s={},o=[{value:"\u7f16\u7801\u652f\u6301\u60c5\u51b5",id:"\u7f16\u7801\u652f\u6301\u60c5\u51b5",level:2},{value:"xrecorder \u72b6\u6001\u56fe",id:"xrecorder-\u72b6\u6001\u56fe",level:2},{value:"Init \u72b6\u6001",id:"init-\u72b6\u6001",level:3},{value:"Prepared \u72b6\u6001",id:"prepared-\u72b6\u6001",level:3},{value:"Started \u72b6\u6001",id:"started-\u72b6\u6001",level:3},{value:"Stopped \u72b6\u6001",id:"stopped-\u72b6\u6001",level:3},{value:"Destroyed \u72b6\u6001",id:"destroyed-\u72b6\u6001",level:3},{value:"\u63a5\u53e3\u51fd\u6570",id:"\u63a5\u53e3\u51fd\u6570",level:2},{value:"\u521b\u5efa\u4e00\u4e2a XRecord",id:"\u521b\u5efa\u4e00\u4e2a-xrecord",level:3},{value:"\u8bbe\u7f6e\u5f55\u5236\u97f3\u9891\u7684\u7f16\u7801\u683c\u5f0f",id:"\u8bbe\u7f6e\u5f55\u5236\u97f3\u9891\u7684\u7f16\u7801\u683c\u5f0f",level:3},{value:"\u83b7\u53d6\u6307\u9488",id:"\u83b7\u53d6\u6307\u9488",level:3},{value:"\u8bbe\u7f6e\u5f55\u5236\u540e\u6587\u4ef6\u7684\u4fdd\u5b58\u7684\u8def\u5f84",id:"\u8bbe\u7f6e\u5f55\u5236\u540e\u6587\u4ef6\u7684\u4fdd\u5b58\u7684\u8def\u5f84",level:3},{value:"\u5c06 XRecord \u7f6e\u4e3a\u51c6\u5907\u72b6\u6001, \u51c6\u5907 Muxer",id:"\u5c06-xrecord-\u7f6e\u4e3a\u51c6\u5907\u72b6\u6001-\u51c6\u5907-muxer",level:3},{value:"\u5c06 XRecord \u7f6e\u4e3a\u542f\u52a8\u72b6\u6001",id:"\u5c06-xrecord-\u7f6e\u4e3a\u542f\u52a8\u72b6\u6001",level:3},{value:"\u5c06 XRecord \u7f6e\u4e3a\u505c\u6b62\u72b6\u6001",id:"\u5c06-xrecord-\u7f6e\u4e3a\u505c\u6b62\u72b6\u6001",level:3},{value:"\u7f16\u7801\u6570\u636e\u5165\u961f\u5c01\u88c5",id:"\u7f16\u7801\u6570\u636e\u5165\u961f\u5c01\u88c5",level:3},{value:"\u9500\u6bc1\u4e00\u4e2a XRecord",id:"\u9500\u6bc1\u4e00\u4e2a-xrecord",level:3},{value:"XRecorder \u5f00\u53d1\u6d41\u7a0b",id:"xrecorder-\u5f00\u53d1\u6d41\u7a0b",level:2},{value:"\u6ce8\u610f\u4e8b\u9879",id:"\u6ce8\u610f\u4e8b\u9879",level:2},{value:"\u793a\u4f8b\u4ee3\u7801",id:"\u793a\u4f8b\u4ee3\u7801",level:2}];function a(e){const r={code:"code",h1:"h1",h2:"h2",h3:"h3",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",ul:"ul",...(0,c.a)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(r.h1,{id:"rtos-\u591a\u5a92\u4f53\u7f16\u7801",children:"RTOS \u591a\u5a92\u4f53\u7f16\u7801"}),"\n",(0,i.jsx)(r.p,{children:"\u4ecb\u7ecd FreeRTOS \u4e0b\u5982\u4f55\u4f7f\u7528 xrecorder \u7684\u63a5\u53e3\u6765\u5f00\u53d1\u5f55\u5236\u5e94\u7528\u7a0b\u5e8f\uff0c\u65b9\u4fbf\u5f55\u5236\u5e94\u7528\u5f00\u53d1\u4eba\u5458\u5feb\u901f\u6b63\u786e\u5730\u5f00\u53d1\uff0c\u4ee5\u53ca\u5f55\u5236\u5e94\u7528\u6d4b\u8bd5\u4eba\u5458\u5982\u4f55\u6839\u636e\u8be5\u6587\u6863\u5bf9\u57fa\u4e8e xrecord \u7684\u5f55\u5236\u5e94\u7528\u8fdb\u884c\u9a8c\u8bc1\u6d4b\u8bd5\u3002"}),"\n",(0,i.jsx)(r.h2,{id:"\u7f16\u7801\u652f\u6301\u60c5\u51b5",children:"\u7f16\u7801\u652f\u6301\u60c5\u51b5"}),"\n",(0,i.jsx)(r.p,{children:"\u76ee\u524d RTOS \u5e73\u53f0\u591a\u5a92\u4f53\u7f16\u7801\u5e94\u7528\u652f\u6301\u7684\u7f16\u7801\u683c\u5f0f\u5206\u522b\u4e3a\uff1apcm\u3001amr\u3001mp3\u3001speex\u3001opus\u3002"}),"\n",(0,i.jsx)(r.p,{children:"\u5176\u4e2d pcm\u3001amr\u3001mp3 \u53ef\u901a\u8fc7 xrecorder \u8fdb\u884c\u7f16\u7801\u4ee5\u53ca\u5f55\u5236\uff1bspeex \u548c opus \u53ef\u901a\u8fc7\u7b2c\u4e09\u65b9\u793a\u4f8b\u5de5\u7a0b\u8fdb\u884c\u7f16\u7801\u3002"}),"\n",(0,i.jsx)(r.h2,{id:"xrecorder-\u72b6\u6001\u56fe",children:"xrecorder \u72b6\u6001\u56fe"}),"\n",(0,i.jsx)(r.p,{children:(0,i.jsx)(r.img,{src:"http://photos.100ask.net/aw-r128-docs/rtos/developer-guide/part1/chapter2/image1.png",alt:""})}),"\n",(0,i.jsx)(r.p,{children:"\u8fd9\u5f20\u72b6\u6001\u8f6c\u6362\u56fe\u6e05\u6670\u5730\u63cf\u8ff0\u4e86 xrecorder \u7684\u5404\u4e2a\u72b6\u6001\uff0c\u4e5f\u5217\u4e3e\u4e86\u4e3b\u8981\u7684\u65b9\u6cd5\u7684\u8c03\u7528\u65f6\u5e8f\uff0c\u6bcf\u79cd\u65b9\u6cd5\u53ea\u80fd\u5728\u4e00\u4e9b\u7279\u5b9a\u7684\u72b6\u6001\u4e0b\u4f7f\u7528\uff0c\u5426\u5219\u4f1a\u51fa\u9519\u3002"}),"\n",(0,i.jsx)(r.h3,{id:"init-\u72b6\u6001",children:"Init \u72b6\u6001"}),"\n",(0,i.jsx)(r.p,{children:"Idle \u72b6\u6001\uff1a\u5f53\u8c03\u7528 XRecordCreate() \u521b\u5efa\u4e00\u4e2a xrecord \u65f6\uff0c\u5904\u4e8e idle \u72b6\u6001\u3002"}),"\n",(0,i.jsx)(r.h3,{id:"prepared-\u72b6\u6001",children:"Prepared \u72b6\u6001"}),"\n",(0,i.jsx)(r.p,{children:"\u8c03\u7528 XRecordPrepare() \u51fd\u6570\u5e76\u8fd4\u56de\u540e\uff0cxrecorder \u5904\u4e8e Prepared \u72b6\u6001\u3002\u5728\u8fd9\u4e2a\u72b6\u6001\u4e0b\u8bf4\u660e\u6240\u6709\u7684\u8d44\u6e90\u90fd\u5df2\u7ecf\u5c31\u7eea\u4e86\uff0c\u8c03\u7528 XRecordStart() \u51fd\u6570\u5c31\u53ef\u4ee5\u8fdb\u884c\u5f55\u5236\u3002"}),"\n",(0,i.jsx)(r.h3,{id:"started-\u72b6\u6001",children:"Started \u72b6\u6001"}),"\n",(0,i.jsx)(r.p,{children:"xrecorder prepare \u5b8c\u6210\u540e\uff0c\u8c03\u7528 XRecordStart() \u8fdb\u884c\u5f55\u5236\uff0c\u5f53\u5e94\u7528\u5f00\u59cb\u5f55\u5236\u540e\uff0cxrecorder \u5c31\u5904\u4e8e Started \u72b6\u6001\uff0c\u8fd9\u8868\u660e xrecorder \u6b63\u5728\u5f55\u5236\u6587\u4ef6\u3002"}),"\n",(0,i.jsx)(r.h3,{id:"stopped-\u72b6\u6001",children:"Stopped \u72b6\u6001"}),"\n",(0,i.jsx)(r.p,{children:"Started \u72b6\u6001\u4e0b\u5747\u53ef\u8c03\u7528 XrecordStop() \u505c\u6b62 xrecorder\uff0c\u800c\u5904\u4e8e Stop \u72b6\u6001\u7684 xrecorder \u8981\u60f3\u91cd\u65b0\u5f55\u5236\uff0c\u9700\u8981\u901a\u8fc7 XRecorderPrepare() \u56de\u5230\u5148\u524d\u7684 Prepared \u72b6\u6001\u91cd\u65b0\u5f00\u59cb\u624d\u53ef\u4ee5\u3002"}),"\n",(0,i.jsx)(r.h3,{id:"destroyed-\u72b6\u6001",children:"Destroyed \u72b6\u6001"}),"\n",(0,i.jsx)(r.p,{children:"\u901a\u8fc7 XRecordDestroy() \u7684\u65b9\u6cd5\u53ef\u4ee5\u8fdb\u5165 Destroyed \u72b6\u6001\uff0c\u53ea\u8981 xrecorder \u4e0d\u518d\u88ab\u4f7f\u7528\uff0c\u5c31\u5e94\u5f53\u5c3d\u5feb\u5c06\u5176 destroy \u6389\u3002"}),"\n",(0,i.jsx)(r.h2,{id:"\u63a5\u53e3\u51fd\u6570",children:"\u63a5\u53e3\u51fd\u6570"}),"\n",(0,i.jsx)(r.h3,{id:"\u521b\u5efa\u4e00\u4e2a-xrecord",children:"\u521b\u5efa\u4e00\u4e2a XRecord"}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-c",children:"XRecord *XRecordCreate()\n"})}),"\n",(0,i.jsx)(r.p,{children:"\u53c2\u6570\uff1a"}),"\n",(0,i.jsxs)(r.ul,{children:["\n",(0,i.jsx)(r.li,{children:"\u65e0"}),"\n"]}),"\n",(0,i.jsx)(r.p,{children:"\u8fd4\u56de\u503c\uff1a"}),"\n",(0,i.jsxs)(r.ul,{children:["\n",(0,i.jsx)(r.li,{children:"\u65e0"}),"\n"]}),"\n",(0,i.jsx)(r.h3,{id:"\u8bbe\u7f6e\u5f55\u5236\u97f3\u9891\u7684\u7f16\u7801\u683c\u5f0f",children:"\u8bbe\u7f6e\u5f55\u5236\u97f3\u9891\u7684\u7f16\u7801\u683c\u5f0f"}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-c",children:"int XRecordSetAudioEncodeType(XRecord *p, XRECODER_AUDIO_ENCODE_TYPE type, XRecordConfig *config)\n"})}),"\n",(0,i.jsx)(r.p,{children:"\u53c2\u6570\uff1a"}),"\n",(0,i.jsxs)(r.ul,{children:["\n",(0,i.jsx)(r.li,{children:"p: \u901a\u8fc7 XRecordCreate \u521b\u5efa\u7684 XRecord \u6307\u9488"}),"\n",(0,i.jsx)(r.li,{children:"type: \u5df2\u652f\u6301\u7684\u7f16\u7801\u683c\u5f0f"}),"\n",(0,i.jsx)(r.li,{children:"config: \u4e0a\u5c42\u5e94\u7528\u5bf9\u97f3\u9891\u5c5e\u6027\u7684\u914d\u7f6e"}),"\n"]}),"\n",(0,i.jsx)(r.p,{children:"\u8fd4\u56de\u503c\uff1a"}),"\n",(0,i.jsxs)(r.ul,{children:["\n",(0,i.jsx)(r.li,{children:"\u6210\u529f: 0; \u5931\u8d25: \u20111"}),"\n"]}),"\n",(0,i.jsx)(r.h3,{id:"\u83b7\u53d6\u6307\u9488",children:"\u83b7\u53d6\u6307\u9488"}),"\n",(0,i.jsx)(r.p,{children:"\u83b7\u53d6\u6307\u5411\u97f3\u9891\u8bbe\u5907\u7ba1\u7406\u6a21\u5757\u7684\u6307\u9488\uff0c\u7528\u4e8e\u5f55\u5236\u97f3\u9891"}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-c",children:"void XRecordSetAudioCap(XRecord* p, const CaptureCtrl* audioSrc)\n"})}),"\n",(0,i.jsx)(r.p,{children:"\u53c2\u6570\uff1a"}),"\n",(0,i.jsxs)(r.ul,{children:["\n",(0,i.jsx)(r.li,{children:"p: \u901a\u8fc7 XRecordCreate \u521b\u5efa\u7684 XRecord \u6307\u9488"}),"\n",(0,i.jsx)(r.li,{children:"audioSrc: \u7531\u4e0a\u5c42\u5e94\u7528\u83b7\u53d6\u7684\u97f3\u9891\u8bbe\u5907\u7ba1\u7406\u6a21\u5757\u7684\u6307\u9488"}),"\n"]}),"\n",(0,i.jsx)(r.p,{children:"\u8fd4\u56de\u503c\uff1a"}),"\n",(0,i.jsxs)(r.ul,{children:["\n",(0,i.jsx)(r.li,{children:"\u65e0"}),"\n"]}),"\n",(0,i.jsx)(r.p,{children:"audioSrc \u53ef\u5728\u4e0a\u5c42\u5e94\u7528\u901a\u8fc7\u8c03\u7528 cedarx \u7684\u97f3\u9891\u8bbe\u5907\u7ba1\u7406\u6a21\u5757\u7684 RTCaptureDeviceCreate \u6765\u521b\u5efa\u3002"}),"\n",(0,i.jsx)(r.h3,{id:"\u8bbe\u7f6e\u5f55\u5236\u540e\u6587\u4ef6\u7684\u4fdd\u5b58\u7684\u8def\u5f84",children:"\u8bbe\u7f6e\u5f55\u5236\u540e\u6587\u4ef6\u7684\u4fdd\u5b58\u7684\u8def\u5f84"}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-c",children:"int XRecordSetDataDstUrl(XRecord* p, const char* pUrl, void* arg, const CdxKeyedVectorT* pHeaders)\n"})}),"\n",(0,i.jsx)(r.p,{children:"\u53c2\u6570\uff1a"}),"\n",(0,i.jsxs)(r.ul,{children:["\n",(0,i.jsx)(r.li,{children:"p: \u901a\u8fc7 XRecordCreate \u521b\u5efa\u7684 XRecord \u6307\u9488"}),"\n",(0,i.jsx)(r.li,{children:"pUrl\uff1aurl \u5730\u5740"}),"\n"]}),"\n",(0,i.jsx)(r.p,{children:"\u8fd4\u56de\u503c\uff1a"}),"\n",(0,i.jsxs)(r.ul,{children:["\n",(0,i.jsx)(r.li,{children:"\u6210\u529f\uff1a0\uff1b\u5931\u8d25\uff1a\u20111"}),"\n"]}),"\n",(0,i.jsx)(r.h3,{id:"\u5c06-xrecord-\u7f6e\u4e3a\u51c6\u5907\u72b6\u6001-\u51c6\u5907-muxer",children:"\u5c06 XRecord \u7f6e\u4e3a\u51c6\u5907\u72b6\u6001, \u51c6\u5907 Muxer"}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-c",children:"int XRecordPrepare(XRecord* p)\n"})}),"\n",(0,i.jsx)(r.p,{children:"\u53c2\u6570\uff1a"}),"\n",(0,i.jsxs)(r.ul,{children:["\n",(0,i.jsx)(r.li,{children:"p\uff1a\u901a\u8fc7 XRecordCreate \u521b\u5efa\u7684 XRecord \u6307\u9488"}),"\n"]}),"\n",(0,i.jsx)(r.p,{children:"\u8fd4\u56de\u503c\uff1a"}),"\n",(0,i.jsxs)(r.ul,{children:["\n",(0,i.jsx)(r.li,{children:"\u6210\u529f\uff1a0\uff1b\u5931\u8d25\uff1a\u20111"}),"\n"]}),"\n",(0,i.jsx)(r.h3,{id:"\u5c06-xrecord-\u7f6e\u4e3a\u542f\u52a8\u72b6\u6001",children:"\u5c06 XRecord \u7f6e\u4e3a\u542f\u52a8\u72b6\u6001"}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-c",children:"int XRecordStart(XRecord* p)\n"})}),"\n",(0,i.jsx)(r.p,{children:"\u53c2\u6570\uff1a"}),"\n",(0,i.jsxs)(r.ul,{children:["\n",(0,i.jsx)(r.li,{children:"p\uff1a\u901a\u8fc7 XRecordCreate \u521b\u5efa\u7684 XRecord \u6307\u9488"}),"\n"]}),"\n",(0,i.jsx)(r.p,{children:"\u8fd4\u56de\u503c\uff1a"}),"\n",(0,i.jsxs)(r.ul,{children:["\n",(0,i.jsx)(r.li,{children:"\u6210\u529f\uff1a0\uff1b\u5931\u8d25\uff1a\u20111"}),"\n"]}),"\n",(0,i.jsx)(r.h3,{id:"\u5c06-xrecord-\u7f6e\u4e3a\u505c\u6b62\u72b6\u6001",children:"\u5c06 XRecord \u7f6e\u4e3a\u505c\u6b62\u72b6\u6001"}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-c",children:"int XRecordStop(XRecord* p)\n"})}),"\n",(0,i.jsx)(r.p,{children:"\u53c2\u6570\uff1a"}),"\n",(0,i.jsxs)(r.ul,{children:["\n",(0,i.jsx)(r.li,{children:"p\uff1a\u901a\u8fc7 XRecordCreate \u521b\u5efa\u7684 XRecord \u6307\u9488"}),"\n"]}),"\n",(0,i.jsx)(r.p,{children:"\u8fd4\u56de\u503c\uff1a"}),"\n",(0,i.jsxs)(r.ul,{children:["\n",(0,i.jsx)(r.li,{children:"\u6210\u529f\uff1a 0\uff1b\u5931\u8d25\uff1a\u20111"}),"\n"]}),"\n",(0,i.jsx)(r.h3,{id:"\u7f16\u7801\u6570\u636e\u5165\u961f\u5c01\u88c5",children:"\u7f16\u7801\u6570\u636e\u5165\u961f\u5c01\u88c5"}),"\n",(0,i.jsx)(r.p,{children:"\u63d0\u4f9b\u63a5\u53e3\u7ed9\u4e0b\u5c42\u7f16\u7801\u6a21\u5757\uff0c\u5c06\u7f16\u7801\u6570\u636e\u653e\u8fdb\u7f13\u5b58\u961f\u5217\u4e2d\u7b49\u5f85\u5c01\u88c5"}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-c",children:"int onAudioDataEnc(XRecord* app, CdxMuxerPacketT* buff)\n"})}),"\n",(0,i.jsx)(r.p,{children:"\u53c2\u6570\uff1a"}),"\n",(0,i.jsxs)(r.ul,{children:["\n",(0,i.jsx)(r.li,{children:"app: xrecorder \u7684\u73af\u5883\u53e5\u67c4\uff1b"}),"\n",(0,i.jsx)(r.li,{children:"buff\uff1a\u7f16\u7801\u540e\u7684\u7f13\u5b58\u6570\u636e"}),"\n"]}),"\n",(0,i.jsx)(r.p,{children:"\u8fd4\u56de\u503c\uff1a"}),"\n",(0,i.jsxs)(r.ul,{children:["\n",(0,i.jsx)(r.li,{children:"\u6210\u529f\uff1a 0\uff1b\u5931\u8d25\uff1a\u20111"}),"\n"]}),"\n",(0,i.jsx)(r.h3,{id:"\u9500\u6bc1\u4e00\u4e2a-xrecord",children:"\u9500\u6bc1\u4e00\u4e2a XRecord"}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-c",children:"int XRecordDestroy(XRecord* p)\n"})}),"\n",(0,i.jsx)(r.p,{children:"\u53c2\u6570\uff1a"}),"\n",(0,i.jsxs)(r.ul,{children:["\n",(0,i.jsx)(r.li,{children:"p\uff1a\u901a\u8fc7 XRecordCreate \u521b\u5efa\u7684 XRecord \u6307\u9488"}),"\n"]}),"\n",(0,i.jsx)(r.p,{children:"\u8fd4\u56de\u503c\uff1a"}),"\n",(0,i.jsxs)(r.ul,{children:["\n",(0,i.jsx)(r.li,{children:"\u6210\u529f\uff1a 0\uff1b\u5931\u8d25\uff1a\u20111"}),"\n"]}),"\n",(0,i.jsx)(r.h2,{id:"xrecorder-\u5f00\u53d1\u6d41\u7a0b",children:"XRecorder \u5f00\u53d1\u6d41\u7a0b"}),"\n",(0,i.jsxs)(r.ol,{children:["\n",(0,i.jsxs)(r.li,{children:[(0,i.jsx)(r.code,{children:"XRecordCreate()"})," //\u521b\u5efa\u4e00\u4e2a\u5f55\u5236\u5e94\u7528"]}),"\n",(0,i.jsxs)(r.li,{children:[(0,i.jsx)(r.code,{children:"XRecordSetAudioCap()"})," //\u8bbe\u7f6e\u97f3\u9891\u91c7\u96c6\u8bbe\u5907\uff1b\u53ef\u5148\u8c03\u7528 ",(0,i.jsx)(r.code,{children:"RTCaptureDeviceCreate"})," \u521b\u5efa\u3002"]}),"\n",(0,i.jsxs)(r.li,{children:[(0,i.jsx)(r.code,{children:"XRecordSetDataDstUrl()"})," //\u8bbe\u7f6e\u5f55\u5236\u540e\u6587\u4ef6\u4fdd\u5b58\u4f4d\u7f6e"]}),"\n",(0,i.jsxs)(r.li,{children:[(0,i.jsx)(r.code,{children:"XRecordSetAudioEncodeType()"})," //\u8bbe\u7f6e\u97f3\u9891\u6570\u636e\u7684\u7f16\u7801\u683c\u5f0f"]}),"\n",(0,i.jsxs)(r.li,{children:[(0,i.jsx)(r.code,{children:"XRecordPrepare()"})," //\u8bbe\u7f6e Muxer\uff0c\u8ba9 xrecorder \u8fdb\u5165\u51c6\u5907\u72b6\u6001"]}),"\n",(0,i.jsxs)(r.li,{children:[(0,i.jsx)(r.code,{children:"XRecordStart()"})," //\u5f00\u59cb\u5f55\u5236"]}),"\n",(0,i.jsxs)(r.li,{children:[(0,i.jsx)(r.code,{children:"XRecordStop()"})," //\u505c\u6b62\u5f55\u5236"]}),"\n",(0,i.jsxs)(r.li,{children:[(0,i.jsx)(r.code,{children:"XRecordDestroy()"})," //\u5f53\u4e0d\u9700\u8981\u8fdb\u884c\u5f55\u5236\u7684\u65f6\u5019\uff0c\u9500\u6bc1 xrecorder"]}),"\n"]}),"\n",(0,i.jsx)(r.h2,{id:"\u6ce8\u610f\u4e8b\u9879",children:"\u6ce8\u610f\u4e8b\u9879"}),"\n",(0,i.jsxs)(r.ol,{children:["\n",(0,i.jsxs)(r.li,{children:["\u5728\u8c03\u7528 XRecordSetAudioCap \u8bbe\u7f6e\u97f3\u9891\u91c7\u96c6\u8bbe\u5907\u4e4b\u524d\uff0c\u9700\u5148\u6253\u5f00\u97f3\u9891\u91c7\u96c6\u8bbe\u5907\u6765\u83b7\u53d6\u53e5\u67c4\u3002\u5728 rtos \u5e73\u53f0\u53ef\u8c03\u7528 libcedarx \u63d0\u4f9b\u7684\u97f3\u9891\u91c7\u96c6\u8bbe\u5907\u63a7\u5236\u6a21\u5757 rtosCaptureControl.c \u4e2d\u7684 ",(0,i.jsx)(r.code,{children:"RTCaptureDeviceCreate"})," \u6765\u521b\u5efa\u53e5\u67c4\u3002"]}),"\n",(0,i.jsx)(r.li,{children:"recorder \u5e94\u7528\u672a\u652f\u6301\u6682\u505c\u5f55\u5236\u3002"}),"\n",(0,i.jsx)(r.li,{children:"recorder \u7684\u5f55\u5236\u65f6\u957f\u4e3a\u8c03\u7528 XRecordStart \u81f3\u8c03\u7528 XRecordStop \u4e4b\u95f4\u7684\u65f6\u957f\u6765\u51b3\u5b9a\uff0c\u56e0\u6b64\u4e0a\u5c42\u5e94\u7528\u9700\u8981\u5f55\u5236\u6307\u5b9a\u65f6\u957f\u7684\u97f3\u9891\u65f6\uff0c\u5f55\u5236\u7684\u6b65\u9aa4\u5e94\u4e3a\u8c03\u7528 XRecordStart\uff0c\u7b49\u5f85\u6307\u5b9a\u7684\u65f6\u95f4\uff0c\u8c03\u7528XRecordStop\u3002"}),"\n"]}),"\n",(0,i.jsx)(r.h2,{id:"\u793a\u4f8b\u4ee3\u7801",children:"\u793a\u4f8b\u4ee3\u7801"}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-c",children:'#include <stdio.h>\n#include <stdlib.h>\n#include <stdbool.h>\n#include <string.h>\n#include <aw_common.h>\n#include <console.h>\n\n#include "vfs.h"\n#include "xrecord.h"\n\n#define RECORDER_LOGD(msg, arg...)      printf("[RECORDER_DBG] <%s : %d> " msg "\\n", __func__, __LINE__, ##arg)\n#define RECORDER_LOGI(msg, arg...)      printf("[RECORDER_INFO] <%s : %d> " msg "\\n", __func__, __LINE__, ##arg)\n#define RECORDER_LOGW(msg, arg...)      printf("[RECORDER_WRN] <%s : %d> " msg "\\n", __func__, __LINE__, ##arg)\n#define RECORDER_LOGE(msg, arg...)      printf("[RECORDER_ERR] <%s : %d> " msg "\\n", __func__, __LINE__, ##arg)\n\ntypedef struct recorder_base recorder_base;\n\ntypedef struct rec_cfg\n{\n    XRECODER_AUDIO_ENCODE_TYPE   type;\n    int                 sample_rate;\n    int                 chan_num;\n    int                 bitrate;\n    int                 sampler_bits;\n} rec_cfg;\n\nstruct recorder_base\n{\n    int (*start)(recorder_base *base, const char *url, const rec_cfg *cfg);\n    int (*stop)(recorder_base *base);\n};\n\nstruct ExampleCustomerWriterImpl\n{\n    CdxWriterT base;\n    vfs_file_t *vfs;\n};\n\ntypedef struct recorder\n{\n    recorder_base base;\n    XRecord *xrecorder;\n    CaptureCtrl *cap;\n} recorder;\n\nrecorder_base *recorder_create();\nint recorder_destroy(recorder_base *base);\n\n/* Example Customer Writer */\nstatic int __CdxExampleConnect(CdxWriterT *writer)\n{\n    struct ExampleCustomerWriterImpl *impl;\n\n    impl = (struct ExampleCustomerWriterImpl *)writer;\n\n    vfs_unlink("data/record/2.amr");\n    impl->vfs = vfs_open("data/record/2.amr", VFS_RDWR | VFS_CREAT);\n    if (impl->vfs == NULL) {\n        return -1;\n    }\n\n    return 0;\n}\n\nstatic int __CdxExampleRead(CdxWriterT *writer, void *buf, int size)\n{\n    return 0;\n}\n\nstatic int __CdxExampleWrite(CdxWriterT *writer, void *buf, int size)\n{\n    uint32_t write_len;\n    struct ExampleCustomerWriterImpl *impl;\n\n    impl = (struct ExampleCustomerWriterImpl *)writer;\n\n    write_len = vfs_write(impl->vfs, buf, size);\n\n    return write_len;\n}\n\nstatic long __CdxExampleSeek(CdxWriterT *writer, long moffset, int mwhere)\n{\n    return 0;\n}\n\nstatic long __CdxExampleTell(CdxWriterT *writer)\n{\n    return 0;\n}\n\nstatic int __CdxExampleClose(CdxWriterT *writer)\n{\n    struct ExampleCustomerWriterImpl *impl;\n\n    impl = (struct ExampleCustomerWriterImpl *)writer;\n\n    vfs_close(impl->vfs);\n    free(impl);\n\n    return 0;\n}\n\nstatic const struct CdxWriterOps exampleCustomerWriteOps =\n{\n    .cdxConnect   =  __CdxExampleConnect,\n    .cdxRead      =  __CdxExampleRead,\n    .cdxWrite     =  __CdxExampleWrite,\n    .cdxSeek      =  __CdxExampleSeek,\n    .cdxTell      =  __CdxExampleTell,\n    .cdxClose     =  __CdxExampleClose\n};\n\nCdxWriterT *ExampleCustomerWriterCreat()\n{\n    struct ExampleCustomerWriterImpl *impl;\n\n    impl = malloc(sizeof(*impl));\n    if (impl == NULL) {\n        printf("example customer writer create fail.\\n");\n        return NULL;\n    }\n\n    memset(impl, 0, sizeof(*impl));\n\n    impl->base.ops = &exampleCustomerWriteOps;\n\n    return &impl->base;\n}\n\n/* Main App */\nstatic void showHelp(){\n    printf("\\n");\n    printf("**************************\\n");\n    printf("* This is a simple audio recoder, when it is started, you can input commands to tell\\n");\n    printf("* what you want it to do.\\n");\n    printf("* Usage: \\n");\n    printf("*   cedarx_record amr 10  : this means record 10s amr music\\n");\n    printf("*   cedarx_record pcm 10  : this means record 10s pcm music\\n");\n    printf("**************************\\n");\n}\n\nrecorder *recorder_singleton = NULL;\n\nstatic int record_start(recorder_base *base, const char *url, const rec_cfg *cfg)\n{\n    recorder *impl = container_of(base, recorder, base);\n\n    XRecordConfig audioConfig;\n\n    if (cfg->type == XRECODER_AUDIO_ENCODE_PCM_TYPE)\n    {\n        audioConfig.nChan = cfg->chan_num;\n        audioConfig.nSamplerate = cfg->sample_rate;\n        audioConfig.nSamplerBits = cfg->sampler_bits;\n        audioConfig.nBitrate = cfg->bitrate;\n    }\n    else if (cfg->type == XRECODER_AUDIO_ENCODE_AMR_TYPE)\n    {\n        audioConfig.nChan = 1;\n        audioConfig.nSamplerate = 8000;//amr-nb 8000Hz amr-wb 16000Hz\n        audioConfig.nSamplerBits = 16;\n        audioConfig.nBitrate = 12200;//amr-nb 12200  amr-wb 23850\n    } else {\n        audioConfig.nChan = cfg->chan_num;\n        audioConfig.nSamplerate = cfg->sample_rate;\n        audioConfig.nSamplerBits = cfg->sampler_bits;\n        audioConfig.nBitrate = cfg->bitrate;\n    }\n\n    XRecordSetDataDstUrl(impl->xrecorder, url, NULL, NULL);\n    XRecordSetAudioEncodeType(impl->xrecorder, cfg->type, &audioConfig);\n\n    XRecordPrepare(impl->xrecorder);\n    XRecordStart(impl->xrecorder);\n    RECORDER_LOGI("record start");\n    return 0;\n}\n\nstatic int record_stop(recorder_base *base)\n{\n    recorder *impl = container_of(base, recorder, base);\n    XRecordStop(impl->xrecorder);\n    return 0;\n}\n\nextern CaptureCtrl* RTCaptureDeviceCreate();\n\nrecorder_base *recorder_create()\n{\n    if (recorder_singleton != NULL)\n        return &recorder_singleton->base;\n\n    recorder *impl = malloc(sizeof(*impl));\n    if (impl == NULL)\n        return NULL;\n    memset(impl, 0, sizeof(*impl));\n\n    impl->xrecorder = XRecordCreate();\n    if (impl->xrecorder == NULL)\n        goto failed;\n\n    impl->cap = (void *)(uintptr_t)RTCaptureDeviceCreate();\n    if (impl->cap == NULL)\n        goto failed;\n    XRecordSetAudioCap(impl->xrecorder, impl->cap);\n\n    impl->base.start = record_start;\n    impl->base.stop = record_stop;\n\n    recorder_singleton = impl;\n\n    return &impl->base;\n\nfailed:\n    RECORDER_LOGE("recorder create failed");\n    if (impl->xrecorder)\n        XRecordDestroy(impl->xrecorder);\n    if (impl)\n        free(impl);\n    return NULL;\n}\n\nint recorder_destroy(recorder_base *base)\n{\n    recorder *impl = container_of(base, recorder, base);\n\n    if (impl->xrecorder) {\n        XRecordDestroy(impl->xrecorder);\n    }\n\n    free(impl);\n\n    recorder_singleton = NULL;\n\n    return 0;\n}\n\nstatic int cedarx_record_test(int argc, char **argv)\n{\n    recorder_base *recorder;\n    rec_cfg cfg;\n    char music_url[64];\n    char file_url[64];\n    CdxWriterT *writer;\n    memset(file_url, 0, 64);\n    if(argc == 3){\n        if( !strncmp("amr", argv[1], sizeof("amr")-1) ){\n            cfg.type = XRECODER_AUDIO_ENCODE_AMR_TYPE;\n            snprintf(file_url, 64, "file://data/%ds.amr", atoi(argv[2]));\n            cfg.sample_rate = 8000;//8000\n            cfg.chan_num = 1;//1\n            cfg.bitrate = 12200;\n            cfg.sampler_bits = 16;\n        }\n        else if( !strncmp("pcm", argv[1], sizeof("pcm")-1) ){\n            cfg.type = XRECODER_AUDIO_ENCODE_PCM_TYPE;\n            snprintf(file_url, 64, "file://data/%ds.pcm", atoi(argv[2]));\n            cfg.sample_rate = 8000;//8000\n            cfg.chan_num = 1;//1\n            cfg.bitrate = 12200;\n            cfg.sampler_bits = 16;\n        }\n        else if( !strncmp("mp3", argv[1], sizeof("mp3")-1) ){\n            cfg.type = XRECODER_AUDIO_ENCODE_MP3_TYPE;\n            snprintf(file_url, 64, "file://data/%ds.mp3", atoi(argv[2]));\n            cfg.sample_rate = 16000;\n            cfg.chan_num = 1;\n            cfg.bitrate = 32000;\n            cfg.sampler_bits = 16;\n        } else {\n            printf("now support!\\n");\n            return -1;\n        }\n    }else{\n        printf("the parameter is error,usage is as following:\\n");\n        showHelp();\n        return -1;\n    }\n\n    recorder = recorder_create();\n    if (recorder == NULL) {\n        printf("recorder create fail, exit\\n");\n        return -1;\n    }\n\n    printf("===start record %s now, last for %d s===\\n", argv[1], atoi(argv[2]));\n    recorder->start(recorder, file_url, &cfg);\n    sleep(atoi(argv[2]));\n    recorder->stop(recorder);\n    printf("record %s over.\\n", argv[1]);\nexit:\n    return recorder_destroy(recorder);\n}\n\nFINSH_FUNCTION_EXPORT_CMD(cedarx_record_test, cedarx_record, cedarx record test demo);\n'})})]})}function p(e={}){const{wrapper:r}={...(0,c.a)(),...e.components};return r?(0,i.jsx)(r,{...e,children:(0,i.jsx)(a,{...e})}):a(e)}},1151:(e,r,n)=>{n.d(r,{Z:()=>l,a:()=>t});var i=n(7294);const c={},d=i.createContext(c);function t(e){const r=i.useContext(d);return i.useMemo((function(){return"function"==typeof e?e(r):{...r,...e}}),[r,e])}function l(e){let r;return r=e.disableParentContext?"function"==typeof e.components?e.components(c):e.components||c:t(e.components),i.createElement(d.Provider,{value:r},e.children)}}}]);