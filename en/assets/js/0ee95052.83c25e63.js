"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[3533],{1111:(n,e,l)=>{l.r(e),l.d(e,{assets:()=>s,contentTitle:()=>a,default:()=>_,frontMatter:()=>i,metadata:()=>c,toc:()=>d});var r=l(5893),t=l(1151);const i={},a="LPUART",c={id:"developer-guide/part2/chapter14",title:"LPUART",description:"\u6a21\u5757\u4ecb\u7ecd",source:"@site/docs/developer-guide/part2/chapter14.md",sourceDirName:"developer-guide/part2",slug:"/developer-guide/part2/chapter14",permalink:"/en/developer-guide/part2/chapter14",draft:!1,unlisted:!1,editUrl:"https://github.com/100askTeam/R128-Docs/tree/main/docs/developer-guide/part2/chapter14.md",tags:[],version:"current",frontMatter:{},sidebar:"classpartoneSidebar",previous:{title:"UART",permalink:"/en/developer-guide/part2/chapter13"},next:{title:"TWI",permalink:"/en/developer-guide/part2/chapter15"}},s={},d=[{value:"\u6a21\u5757\u4ecb\u7ecd",id:"\u6a21\u5757\u4ecb\u7ecd",level:2},{value:"\u6a21\u5757\u914d\u7f6e",id:"\u6a21\u5757\u914d\u7f6e",level:2},{value:"\u6e90\u7801\u7ed3\u6784",id:"\u6e90\u7801\u7ed3\u6784",level:2},{value:"\u6a21\u5757\u63a5\u53e3\u8bf4\u660e",id:"\u6a21\u5757\u63a5\u53e3\u8bf4\u660e",level:2},{value:"\u521d\u59cb\u5316 LPUART \u9a71\u52a8",id:"\u521d\u59cb\u5316-lpuart-\u9a71\u52a8",level:3},{value:"\u5378\u8f7d LPUART \u9a71\u52a8",id:"\u5378\u8f7d-lpuart-\u9a71\u52a8",level:3},{value:"\u8bbe\u7f6e\u6ce2\u7279\u7387\u53ca\u53c2\u6570",id:"\u8bbe\u7f6e\u6ce2\u7279\u7387\u53ca\u53c2\u6570",level:3},{value:"\u63a5\u6536\u5904\u7406",id:"\u63a5\u6536\u5904\u7406",level:3},{value:"\u63a5\u6536\u5bf9\u6bd4\u5904\u7406",id:"\u63a5\u6536\u5bf9\u6bd4\u5904\u7406",level:3},{value:"\u542f\u7528\u63a5\u6536\u5bf9\u6bd4\u5904\u7406\u56de\u8c03",id:"\u542f\u7528\u63a5\u6536\u5bf9\u6bd4\u5904\u7406\u56de\u8c03",level:3},{value:"\u7981\u7528\u63a5\u6536\u5bf9\u6bd4\u5904\u7406\u56de\u8c03",id:"\u7981\u7528\u63a5\u6536\u5bf9\u6bd4\u5904\u7406\u56de\u8c03",level:3},{value:"\u914d\u7f6ePM\u7ed5\u8fc7\u6a21\u5f0f",id:"\u914d\u7f6epm\u7ed5\u8fc7\u6a21\u5f0f",level:3},{value:"\u6a21\u5757\u4f7f\u7528\u8303\u4f8b",id:"\u6a21\u5757\u4f7f\u7528\u8303\u4f8b",level:2}];function p(n){const e={code:"code",h1:"h1",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",ul:"ul",...(0,t.a)(),...n.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(e.h1,{id:"lpuart",children:"LPUART"}),"\n",(0,r.jsx)(e.h2,{id:"\u6a21\u5757\u4ecb\u7ecd",children:"\u6a21\u5757\u4ecb\u7ecd"}),"\n",(0,r.jsx)(e.p,{children:"LPUART \u9a71\u52a8\u4e3b\u8981\u5b9e\u73b0\u8bbe\u5907\u9a71\u52a8\u7684\u5e95\u5c42\u7ec6\u8282\uff0c\u5e76\u4e3a\u4e0a\u5c42\u63d0\u4f9b\u4e00\u5957\u6807\u51c6\u7684 API \u63a5\u53e3\u4ee5\u4f9b\u4f7f\u7528\u3002"}),"\n",(0,r.jsx)(e.h2,{id:"\u6a21\u5757\u914d\u7f6e",children:"\u6a21\u5757\u914d\u7f6e"}),"\n",(0,r.jsx)(e.p,{children:"\u914d\u7f6e\u8def\u5f84\u5982\u4e0b:"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{children:"Kernel Setup ---\x3e\n    Drivers Setup ---\x3e\n        SoC HAL Drivers ---\x3e\n            LPUART Devices ---\x3e\n                [*] enable lpuart driver\n"})}),"\n",(0,r.jsx)(e.h2,{id:"\u6e90\u7801\u7ed3\u6784",children:"\u6e90\u7801\u7ed3\u6784"}),"\n",(0,r.jsx)(e.p,{children:"LPUART \u6a21\u5757\u6e90\u7801\u7ed3\u6784\u5982\u4e0b\u6240\u793a\uff1a"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-c",children:"hal/source/lpuart/             ---- \u9a71\u52a8\u6e90\u7801\n\u251c\u2500\u2500 hal_lpuart.c\n\u251c\u2500\u2500 Kconfig\n\u251c\u2500\u2500 Makefile\n\u251c\u2500\u2500 platform\n\u2502   \u251c\u2500\u2500 lpuart-sun20iw2p1.h    ---- \u5e73\u53f0\u5730\u5740\uff0c\u5f15\u811a\u590d\u7528\u7b49\u914d\u7f6e\n\u2502   \u2514\u2500\u2500 ...\n\u251c\u2500\u2500 platform-lpuart.h\n\u2514\u2500\u2500 lpuart.h\ninclude/hal/                   ---- \u9a71\u52a8APIs\u58f0\u660e\u5934\u6587\u4ef6\n\u2514\u2500\u2500 hal_lpuart.h\n"})}),"\n",(0,r.jsx)(e.h2,{id:"\u6a21\u5757\u63a5\u53e3\u8bf4\u660e",children:"\u6a21\u5757\u63a5\u53e3\u8bf4\u660e"}),"\n",(0,r.jsx)(e.p,{children:"\u9700\u8981\u5305\u542b\u5934\u6587\u4ef6"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-c",children:"#include <hal_lpuart.h>\n"})}),"\n",(0,r.jsx)(e.h3,{id:"\u521d\u59cb\u5316-lpuart-\u9a71\u52a8",children:"\u521d\u59cb\u5316 LPUART \u9a71\u52a8"}),"\n",(0,r.jsx)(e.p,{children:"\u51fd\u6570\u539f\u578b\uff1a"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-c",children:"int32_t hal_lpuart_init(int32_t lpuart_port)\n"})}),"\n",(0,r.jsx)(e.p,{children:"\u53c2\u6570\uff1a"}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:"lpuart_port\uff1aLPUART \u7aef\u53e3\u53f7"}),"\n"]}),"\n",(0,r.jsx)(e.p,{children:"\u8fd4\u56de\u503c\uff1a"}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:"SUNXI_HAL_OK: \u6210\u529f"}),"\n",(0,r.jsx)(e.li,{children:"HAL_LPUART_STATUS_ERROR: \u5931\u8d25"}),"\n"]}),"\n",(0,r.jsx)(e.h3,{id:"\u5378\u8f7d-lpuart-\u9a71\u52a8",children:"\u5378\u8f7d LPUART \u9a71\u52a8"}),"\n",(0,r.jsx)(e.p,{children:"\u51fd\u6570\u539f\u578b\uff1a"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-c",children:"int32_t hal_lpuart_deinit(int32_t lpuart_port)\n"})}),"\n",(0,r.jsx)(e.p,{children:"\u53c2\u6570\uff1a"}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:"lpuart_port\uff1aLPUART \u7aef\u53e3\u53f7"}),"\n"]}),"\n",(0,r.jsx)(e.p,{children:"\u8fd4\u56de\u503c\uff1a"}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:"SUNXI_HAL_OK: \u6210\u529f"}),"\n"]}),"\n",(0,r.jsx)(e.h3,{id:"\u8bbe\u7f6e\u6ce2\u7279\u7387\u53ca\u53c2\u6570",children:"\u8bbe\u7f6e\u6ce2\u7279\u7387\u53ca\u53c2\u6570"}),"\n",(0,r.jsx)(e.p,{children:"\u51fd\u6570\u539f\u578b\uff1a"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-c",children:"int32_t hal_lpuart_control(lpuart_port_t lpuart_port, int cmd, void *args)\n"})}),"\n",(0,r.jsx)(e.p,{children:"\u53c2\u6570\uff1a"}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:"lpuart_port_t\uff1aLPUART \u7aef\u53e3\u53f7"}),"\n",(0,r.jsx)(e.li,{children:"cmd\uff1a\u9884\u7559\uff0c\u6682\u672a\u4f7f\u7528"}),"\n",(0,r.jsx)(e.li,{children:"args\uff1a\u6307\u5411 _lpuart_config_t \u7c7b\u578b\u53d8\u91cf\u7684\u6570\u7ec4"}),"\n"]}),"\n",(0,r.jsx)(e.p,{children:"\u8fd4\u56de\u503c\uff1a"}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:"SUNXI_HAL_OK: \u6210\u529f"}),"\n",(0,r.jsx)(e.li,{children:"HAL_LPUART_STATUS_ERROR: \u5931\u8d25"}),"\n"]}),"\n",(0,r.jsx)(e.h3,{id:"\u63a5\u6536\u5904\u7406",children:"\u63a5\u6536\u5904\u7406"}),"\n",(0,r.jsx)(e.p,{children:"\u51fd\u6570\u539f\u578b\uff1a"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-c",children:"int32_t hal_lpuart_receive(int32_t dev, uint8_t *data, uint32_t num)\n"})}),"\n",(0,r.jsx)(e.p,{children:"\u53c2\u6570\uff1a"}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:"dev\uff1aLPUART \u7aef\u53e3\u53f7"}),"\n",(0,r.jsx)(e.li,{children:"data: \u63a5\u6536\u6570\u636e\u7f13\u51b2\u533a"}),"\n",(0,r.jsx)(e.li,{children:"num: \u63a5\u6536\u6570\u636e\u957f\u5ea6"}),"\n"]}),"\n",(0,r.jsx)(e.p,{children:"\u8fd4\u56de\u503c\uff1a"}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:"size: \u6210\u529f\u63a5\u6536\u7684\u5b57\u8282\u6570"}),"\n"]}),"\n",(0,r.jsx)(e.h3,{id:"\u63a5\u6536\u5bf9\u6bd4\u5904\u7406",children:"\u63a5\u6536\u5bf9\u6bd4\u5904\u7406"}),"\n",(0,r.jsx)(e.p,{children:"\u51fd\u6570\u539f\u578b\uff1a"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-c",children:"int32_t hal_lpuart_rx_cmp(lpuart_port_t lpuart_port, uint8_t cmp_len, uint8_t *cmp_data);\n"})}),"\n",(0,r.jsx)(e.p,{children:"\u53c2\u6570\uff1a"}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:"lpuart_port\uff1aLPUART \u7aef\u53e3\u53f7"}),"\n",(0,r.jsx)(e.li,{children:"cmp_len\uff1a\u6bd4\u8f83\u6570\u636e\u7684\u957f\u5ea6"}),"\n",(0,r.jsx)(e.li,{children:"cmp_data\uff1a\u6bd4\u8f83\u7684\u6570\u636e"}),"\n"]}),"\n",(0,r.jsx)(e.p,{children:"\u8fd4\u56de\u503c\uff1a"}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:"SUNXI_HAL_OK: \u6210\u529f"}),"\n",(0,r.jsx)(e.li,{children:"HAL_LPUART_STATUS_ERROR: \u5931\u8d25"}),"\n"]}),"\n",(0,r.jsx)(e.h3,{id:"\u542f\u7528\u63a5\u6536\u5bf9\u6bd4\u5904\u7406\u56de\u8c03",children:"\u542f\u7528\u63a5\u6536\u5bf9\u6bd4\u5904\u7406\u56de\u8c03"}),"\n",(0,r.jsx)(e.p,{children:"\u51fd\u6570\u539f\u578b\uff1a"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-c",children:"int32_t hal_lpuart_enable_rx_cmp(lpuart_port_t lpuart_port, lpuart_callback_t cb, void *arg);\n"})}),"\n",(0,r.jsx)(e.p,{children:"\u53c2\u6570\uff1a"}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:"lpuart_port\uff1aLPUART \u7aef\u53e3\u53f7"}),"\n",(0,r.jsx)(e.li,{children:"cb\uff1a\u5904\u7406\u56de\u8c03\u51fd\u6570"}),"\n",(0,r.jsx)(e.li,{children:"arg\uff1a\u56de\u8c03\u51fd\u6570\u7684\u53c2\u6570"}),"\n"]}),"\n",(0,r.jsx)(e.p,{children:"\u8fd4\u56de\u503c\uff1a"}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:"SUNXI_HAL_OK: \u6210\u529f"}),"\n",(0,r.jsx)(e.li,{children:"HAL_LPUART_STATUS_ERROR: \u5931\u8d25"}),"\n"]}),"\n",(0,r.jsx)(e.h3,{id:"\u7981\u7528\u63a5\u6536\u5bf9\u6bd4\u5904\u7406\u56de\u8c03",children:"\u7981\u7528\u63a5\u6536\u5bf9\u6bd4\u5904\u7406\u56de\u8c03"}),"\n",(0,r.jsx)(e.p,{children:"\u51fd\u6570\u539f\u578b\uff1a"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-c",children:"int32_t hal_lpuart_disable_rx_cmp(lpuart_port_t lpuart_port);\n"})}),"\n",(0,r.jsx)(e.p,{children:"\u53c2\u6570\uff1a"}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:"lpuart_port\uff1aLPUART \u7aef\u53e3\u53f7"}),"\n"]}),"\n",(0,r.jsx)(e.p,{children:"\u8fd4\u56de\u503c\uff1a"}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:"SUNXI_HAL_OK: \u6210\u529f"}),"\n",(0,r.jsx)(e.li,{children:"HAL_LPUART_STATUS_ERROR: \u5931\u8d25"}),"\n"]}),"\n",(0,r.jsx)(e.h3,{id:"\u914d\u7f6epm\u7ed5\u8fc7\u6a21\u5f0f",children:"\u914d\u7f6ePM\u7ed5\u8fc7\u6a21\u5f0f"}),"\n",(0,r.jsx)(e.p,{children:"\u51fd\u6570\u539f\u578b\uff1a"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-c",children:"int32_t HAL_LPUART_SetBypassPmMode(lpuart_port_t lpuart_port, uint8_t mode);\n"})}),"\n",(0,r.jsx)(e.p,{children:"\u53c2\u6570\uff1a"}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:"lpuart_port\uff1aLPUART \u7aef\u53e3\u53f7"}),"\n",(0,r.jsx)(e.li,{children:"mode\uff1a\u914d\u7f6e\u6a21\u5f0f"}),"\n"]}),"\n",(0,r.jsx)(e.p,{children:"\u8fd4\u56de\u503c\uff1a"}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:"SUNXI_HAL_OK: \u6210\u529f"}),"\n",(0,r.jsx)(e.li,{children:"HAL_LPUART_STATUS_ERROR: \u5931\u8d25"}),"\n"]}),"\n",(0,r.jsx)(e.h2,{id:"\u6a21\u5757\u4f7f\u7528\u8303\u4f8b",children:"\u6a21\u5757\u4f7f\u7528\u8303\u4f8b"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-c",children:'#include <stdio.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <string.h>\n#include <hal_log.h>\n#include <hal_cmd.h>\n#include <hal_timer.h>\n#include <hal_lpuart.h>\n#include <hal_uart.h>\n\n/* find a free uart_port or pc com as source */\n#define UART_TEST UART_1\n#define TEST_LEN 5\n\nstatic void cmd_usage(void)\n{\n    printf("Usage:\\n"\n        "\\t hal_lpuart <port> <baudrate>\\n");\n}\n\nvoid test_recv_data(lpuart_port_t port)\n{\n    printf("enter recv data test\\n");\n    hal_lpuart_enable_rx_data(port, NULL, NULL);\n    /* use uart as source */\n    hal_uart_init(UART_TEST);\n    hal_uart_send(UART_TEST, "a", 1);\n    /* use pc com as source */\n    printf("enter\\n");\n    hal_sleep(5);\n    hal_lpuart_disable_rx_data(port);\n}\n\nstatic void compare_callback(void *arg)\n{\n    printf("data compare success!\\n");\n}\n\nvoid test_cmp_data(lpuart_port_t port)\n{\n    printf("enter cmp data test\\n");\n    char cmp[TEST_LEN + 1] = "abcde";\n\n    if (hal_lpuart_init(port)) {\n        printf("lpuart %d not inited\\n", port);\n        return;\n    }\n\n    hal_lpuart_rx_cmp(port, TEST_LEN, cmp);\n    hal_lpuart_enable_rx_cmp(port, compare_callback, NULL);\n    /* use uart as source, stop bit of uart should be 2 */\n    hal_uart_init(UART_TEST);\n    hal_uart_send(UART_TEST, cmp, TEST_LEN);\n    /* use pc com as source */\n    printf("enter abcde\\n");\n    hal_sleep(5);\n    hal_lpuart_disable_rx_cmp(port);\n}\n\nvoid lpuart_reset_multiplex()\n{\n    lpuart_multiplex(LPUART_0, UART_0);\n    lpuart_multiplex(LPUART_1, UART_1);\n}\n\nint cmd_test_lpuart(int argc, char **argv)\n{\n    if (argc != 3) {\n        cmd_usage();\n        return -1;\n    }\n\n    lpuart_port_t port;\n    uint32_t baudrate;\n\n    port = strtol(argv[1], NULL, 0);\n    baudrate = strtol(argv[2], NULL, 0);\n\n    if (hal_lpuart_init(port) != SUNXI_HAL_OK) {\n        printf("Fail to init lpuart\\n");\n        return -1;\n    }\n\n    if (port == 0) {\n        lpuart_multiplex(LPUART_0, UART_TEST);\n    } else if (port == 1) {\n        lpuart_multiplex(LPUART_1, UART_TEST);\n    }\n    test_recv_data(port);\n    test_cmp_data(port);\n\n    lpuart_reset_multiplex();\n\n    return 0;\n}\n\nFINSH_FUNCTION_EXPORT_CMD(cmd_test_lpuart, hal_lpuart, lpuart hal APIs tests)\n``\n'})})]})}function _(n={}){const{wrapper:e}={...(0,t.a)(),...n.components};return e?(0,r.jsx)(e,{...n,children:(0,r.jsx)(p,{...n})}):p(n)}},1151:(n,e,l)=>{l.d(e,{Z:()=>c,a:()=>a});var r=l(7294);const t={},i=r.createContext(t);function a(n){const e=r.useContext(i);return r.useMemo((function(){return"function"==typeof n?n(e):{...e,...n}}),[e,n])}function c(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(t):n.components||t:a(n.components),r.createElement(i.Provider,{value:e},n.children)}}}]);